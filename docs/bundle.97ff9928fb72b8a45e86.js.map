{"version":3,"sources":["webpack:///bundle.97ff9928fb72b8a45e86.js","webpack:///webpack/bootstrap d27c9f43292f42bc6d5e","webpack:///./utils.ts","webpack:///./app.common.ts","webpack:///./event-store.ts","webpack:///./~/uuid/index.js","webpack:///./domain/todo-list.ts","webpack:///./controllers/history-todo-controller.ts","webpack:///./read.ts","webpack:///./~/uuid/lib/bytesToUuid.js","webpack:///./~/uuid/lib/rng-browser.js","webpack:///./controllers/add-todo-form-controller.ts","webpack:///./controllers/body-controller.ts","webpack:///./controllers/completed-todo-list-controller.ts","webpack:///./controllers/event-list-controller.ts","webpack:///./controllers/event-list-group-controller.ts","webpack:///./controllers/event-text-controller.ts","webpack:///./controllers/history-todo-list-panel-controller.ts","webpack:///./controllers/history-todo-title-panel-controller.ts","webpack:///./controllers/incomplete-todo-list-controller.ts","webpack:///./controllers/todo-actions-panel-buttons-controller.ts","webpack:///./controllers/todo-actions-panel-controller.ts","webpack:///./controllers/todo-controller.ts","webpack:///./controllers/todo-list-controller.ts","webpack:///./controllers/todo-list-group-controller.ts","webpack:///./controllers/todo-list-panel-controller.ts","webpack:///./controllers/todo-rename-panel-controller.ts","webpack:///./controllers/todo-title-controller.ts","webpack:///./controllers/todo-title-panel-controller.ts","webpack:///./app.ts","webpack:///./domain/aggregate-root.ts","webpack:///./domain/events.ts","webpack:///./domain/todo.ts","webpack:///./~/idb/lib/idb.js","webpack:///./~/uuid/v1.js","webpack:///./~/uuid/v4.js","webpack:///(webpack)/buildin/global.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","templateClone","id","selector","template","document","querySelector","Error","importNode","content","fillControllerElements","parentNode","controllerName","newChild","elems","findControllerElements","Array","forEach","e","innerHTML","appendChild","findAllElements","fillContentElements","propName","findContentElements","textContent","setAttrElements","attrName","findAttrElements","setAttribute","findElement","element","elements","querySelectorAll","length","getRequiredAttribute","attributeName","getAttribute","refreshLists","di","todoListId","event_store_1","domainEventsByAggregate","then","events","todoList","todo_list_1","TodoList","utils_1","incompleteTodoListController","todos","completedTodoListController","completedTodos","eventListController","refreshBody","bodyController","invalidNameInputHandler","clearValidation","$form","removeClass","$button","addClass","off","validationEventNamespace","$input","input","currentTarget","$","closest","next","children","uuid_1","v4","on","validity","valid","focusOutEvent","contains","relatedTarget","todoIdDataAttrName","eventIdDataAttrName","open","idb_1","default","dbName","db","oldVersion","createObjectStore","domainEventStoreName","autoIncrement","keyPath","eventIdPropName","createIndex","aggregateIdPropName","allDomainEvents","version","cursorCallback","cursor","push","continue","tx","transaction","store","objectStore","iterateCursor","IDBKeyRange","upperBound","complete","aggregateId","event","index","postDomainEvents","x","add","DomainEventType","v1","uuid","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","writable","setPrototypeOf","__proto__","_createClass","defineProperties","target","props","descriptor","key","protoProps","staticProps","_get","receiver","Function","desc","getOwnPropertyDescriptor","undefined","parent","getPrototypeOf","aggregate_root_1","events_1","todo_1","_aggregate_root_1$Agg","this","apply","arguments","_todos","_id","Todo","todoId","todoName","findIndex","splice","oldTodo","newTodo","CompletedTodo","todoCompletionTimestamp","todo","find","arraySwap","arr","y","a","_this2","incompleteTodoPositions","reduce","isCompleted","from","to","todoOffset","_i","agId","applyAndStage","TodoAdded","TodoRemoved","completionTimestamp","TodoCompleted","TodoUncompleted","TodoRenamed","offset","TodoPositionChanged","filter","sort","AggregateRoot","historyTodoController","fragment","historyTodoTitlePanelController","todoListEvents","lists","todoLists","type","indexOf","bytesToUuid","buf","bth","byteToHex","toString","substr","global","rng","crypto","msCrypto","getRandomValues","rnds8","Uint8Array","rnds","r","Math","random","addTodoFormController","addTodoForm","addTodoInput","app_common_1","submit","preventDefault","read_1","reset","uncommittedEvents","catch","console","log","todoListPanelController","createDocumentFragment","todoListController","historyDi","assign","todoController","history_todo_controller_1","eventListDelegatedEventTarget","refreshBodyEventNamespace","e2","originalEvent","which","eventId","historyEvents","slice","parseInt","historyTodoListPanelController","eventListGroupController","listItemFragment","eventTextController","todoTitleController","todoActionsPanelButtonsController","todoActionsPanelController","todoTitlePanelController","todoRenamePanelController","todoListGroupController","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","done","err","return","completeTodoBtnHandler","isComplete","todoActionsBtn","refreshEvents","refreshTodoList","Date","now","uncomplete","$todoListDelegatedEventTarget","val","rename","changePosition","refeshTodoList","remove","$defaultPanel","$actionsPanel","$bothPanels","actionsBtnGroup","eventNamespace","toggle","closeEvent","$renamePanel","first","focus","prev","inputId","newInputId","label","titleFragment","completionDateFragment","date","toLocaleDateString","add_todo_form_controller_1","body_controller_1","completed_todo_list_controller_1","event_list_controller_1","event_list_group_controller_1","event_text_controller_1","history_todo_list_panel_controller_1","history_todo_title_panel_controller_1","incomplete_todo_list_controller_1","todo_actions_panel_buttons_controller_1","todo_actions_panel_controller_1","todo_controller_1","todo_list_controller_1","todo_list_group_controller_1","todo_list_panel_controller_1","todo_rename_panel_controller_1","todo_title_controller_1","todo_title_panel_controller_1","window","indexedDB","alert","init","_uncommittedEvents","_Todo","_this","toArray","promisifyRequest","request","Promise","resolve","reject","onsuccess","result","onerror","error","promisifyRequestCall","obj","method","args","promisifyCursorRequestCall","Cursor","proxyProperties","ProxyClass","targetProp","properties","prop","set","proxyRequestMethods","proxyMethods","proxyCursorRequestMethods","Index","_index","_cursor","_request","ObjectStore","_store","Transaction","idbTransaction","_tx","oncomplete","onabort","UpgradeDB","_db","DB","IDBIndex","IDBCursor","methodName","IDBObjectStore","IDBTransaction","IDBDatabase","funcName","replace","callback","nativeObject","getAll","query","count","items","exp","upgradeCallback","onupgradeneeded","delete","options","b","clockseq","_clockseq","msecs","getTime","nsecs","_lastNSecs","dt","_lastMSecs","tl","tmh","node","_nodeId","_seedBytes","ii","g","eval"],"mappings":"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","file":"bundle.97ff9928fb72b8a45e86.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 28);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction templateClone(id) {\n    var selector = \"template#\" + id;\n    var template = document.querySelector(selector);\n    if (!template) {\n        throw new Error(\"Document missing required '\" + selector + \"' element\");\n    }\n    var fragment = document.importNode(template.content, true);\n    return fragment;\n}\nexports.templateClone = templateClone;\nfunction fillControllerElements(parentNode, controllerName, newChild) {\n    var elems = findControllerElements(parentNode, controllerName);\n    // NodeList isn't iterable on Edge, so you can't use array.forEach()\n    Array.prototype.forEach.call(elems, function (e) {\n        e.innerHTML = \"\";\n        e.appendChild(newChild);\n    });\n}\nexports.fillControllerElements = fillControllerElements;\nfunction findControllerElements(parentNode, controllerName) {\n    var selector = \"[data-estd-controller='\" + controllerName + \"']\";\n    return findAllElements(parentNode, selector);\n}\nfunction fillContentElements(parentNode, propName, content) {\n    var elems = findContentElements(parentNode, propName);\n    // NodeList isn't iterable on Edge, so you can't use array.forEach()\n    Array.prototype.forEach.call(elems, function (e) {\n        e.textContent = content;\n    });\n}\nexports.fillContentElements = fillContentElements;\nfunction findContentElements(parentNode, propName) {\n    var selector = \"[data-estd-content='\" + propName + \"']\";\n    return findAllElements(parentNode, selector);\n}\nfunction setAttrElements(parentNode, attrName, value) {\n    var elems = findAttrElements(parentNode, attrName);\n    // NodeList isn't iterable on Edge, so you can't use array.forEach()\n    Array.prototype.forEach.call(elems, function (e) {\n        e.setAttribute(attrName, value);\n    });\n}\nexports.setAttrElements = setAttrElements;\nfunction findAttrElements(parentNode, attrName) {\n    var selector = \"[data-estd-attr='\" + attrName + \"']\";\n    return findAllElements(parentNode, selector);\n}\nfunction findElement(parentNode, selector) {\n    var element = parentNode.querySelector(selector);\n    if (!element) {\n        throw new Error(\"'\" + parentNode + \"' missing required '\" + selector + \"' element\");\n    }\n    return element;\n}\nexports.findElement = findElement;\nfunction findAllElements(parentNode, selector) {\n    var elements = parentNode.querySelectorAll(selector);\n    if (!elements.length) {\n        throw new Error(\"'\" + parentNode + \"' missing required '\" + selector + \"' element\");\n    }\n    return elements;\n}\nfunction getRequiredAttribute(element, attributeName) {\n    var value = element.getAttribute(attributeName);\n    if (!value) {\n        throw new Error(\"'\" + element + \"' missing required '\" + attributeName + \"' attribute\");\n    }\n    return value;\n}\nexports.getRequiredAttribute = getRequiredAttribute;\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar uuid_1 = __webpack_require__(3);\nvar todo_list_1 = __webpack_require__(4);\nvar event_store_1 = __webpack_require__(2);\nvar utils_1 = __webpack_require__(0);\nexports.todoIdDataAttrName = \"data-estd-todo-id\";\nexports.eventIdDataAttrName = \"data-estd-event-id\";\nfunction refreshLists(di, todoListId) {\n    return event_store_1.domainEventsByAggregate(todoListId).then(function (events) {\n        var todoList = new todo_list_1.TodoList(events);\n        utils_1.fillControllerElements(document, \"incompleteTodoListController\", di.incompleteTodoListController(di, todoList.todos));\n        utils_1.fillControllerElements(document, \"completedTodoListController\", di.completedTodoListController(di, todoList.completedTodos));\n        utils_1.fillControllerElements(document, \"eventListController\", di.eventListController(di, events));\n    });\n}\nexports.refreshLists = refreshLists;\nfunction refreshBody(di, todoListId) {\n    return event_store_1.domainEventsByAggregate(todoListId).then(function (events) {\n        utils_1.fillControllerElements(document, \"bodyController\", di.bodyController(di, events));\n    });\n}\nexports.refreshBody = refreshBody;\nfunction invalidNameInputHandler(e) {\n    var input = e.currentTarget;\n    var $input = $(input);\n    var $form = $input.closest(\"form\");\n    var $button = $input.next().children(\"button\");\n    $form.addClass(\"has-error\");\n    $button.removeClass(\"btn-success\").addClass(\"btn-danger\");\n    var validationEventNamespace = \".nameTodoInputValidation:\" + uuid_1.v4();\n    function clearValidation() {\n        $form.removeClass(\"has-error\");\n        $button.removeClass(\"btn-danger\").addClass(\"btn-success\");\n        $form.off(validationEventNamespace);\n        $input.off(validationEventNamespace);\n    }\n    $input.on(\"input\" + validationEventNamespace, function () {\n        if (input.validity.valid) {\n            clearValidation();\n        }\n    });\n    $form.on(\"focusout\" + validationEventNamespace, function (focusOutEvent) {\n        if (!focusOutEvent.currentTarget.contains(focusOutEvent.relatedTarget)) {\n            clearValidation();\n        }\n    });\n}\nexports.invalidNameInputHandler = invalidNameInputHandler;\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar idb_1 = __webpack_require__(32);\nvar DomainEventType;\n(function (DomainEventType) {\n    DomainEventType[DomainEventType[\"TodoAdded\"] = 0] = \"TodoAdded\";\n    DomainEventType[DomainEventType[\"TodoRemoved\"] = 1] = \"TodoRemoved\";\n    DomainEventType[DomainEventType[\"TodoCompleted\"] = 2] = \"TodoCompleted\";\n    DomainEventType[DomainEventType[\"TodoUncompleted\"] = 3] = \"TodoUncompleted\";\n    DomainEventType[DomainEventType[\"TodoRenamed\"] = 4] = \"TodoRenamed\";\n    DomainEventType[DomainEventType[\"TodoPositionChanged\"] = 5] = \"TodoPositionChanged\";\n})(DomainEventType = exports.DomainEventType || (exports.DomainEventType = {}));\nvar dbName = \"estd-db\";\nvar domainEventStoreName = \"domain-event\";\nvar aggregateIdPropName = \"aggregateId\";\nvar eventIdPropName = \"id\";\nfunction open() {\n    return idb_1.default.open(dbName, 1, function (db) {\n        switch (db.oldVersion) {\n            case 0:\n                db.createObjectStore(domainEventStoreName, { autoIncrement: true, keyPath: eventIdPropName }).createIndex(aggregateIdPropName, aggregateIdPropName);\n        }\n    });\n}\nfunction allDomainEvents(version) {\n    return open().then(function (db) {\n        var events = [];\n        var tx = db.transaction(domainEventStoreName);\n        var store = tx.objectStore(domainEventStoreName);\n        function cursorCallback(cursor) {\n            if (!cursor) {\n                return;\n            }\n            events.push(cursor.value);\n            // tslint:disable-next-line:no-floating-promises\n            cursor.continue();\n        }\n        // iterateCursor() should be replace with usage of openCursor() when \"idb\" decides it is safe to do so.\n        if (version) {\n            store.iterateCursor(IDBKeyRange.upperBound(version), cursorCallback);\n        } else {\n            store.iterateCursor(cursorCallback);\n        }\n        return tx.complete.then(function () {\n            return events;\n        });\n    });\n}\nexports.allDomainEvents = allDomainEvents;\nfunction domainEventsByAggregate(aggregateId, version) {\n    return open().then(function (db) {\n        var events = [];\n        var tx = db.transaction(domainEventStoreName);\n        var index = tx.objectStore(domainEventStoreName).index(aggregateIdPropName);\n        function cursorCallback(cursor) {\n            if (!cursor) {\n                return;\n            }\n            var event = cursor.value;\n            if (!version || event.id <= version) {\n                events.push(event);\n            }\n            // tslint:disable-next-line:no-floating-promises\n            cursor.continue();\n        }\n        // iterateCursor() should be replace with usage of openCursor() when \"idb\" decides it is safe to do so.\n        index.iterateCursor(cursorCallback);\n        return tx.complete.then(function () {\n            return events;\n        });\n    });\n}\nexports.domainEventsByAggregate = domainEventsByAggregate;\nfunction postDomainEvents(events) {\n    return open().then(function (db) {\n        var tx = db.transaction(domainEventStoreName, \"readwrite\");\n        var store = tx.objectStore(domainEventStoreName);\n        events.forEach(function (x) {\n            return store.add(x);\n        });\n        return tx.complete;\n    });\n}\nexports.postDomainEvents = postDomainEvents;\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar v1 = __webpack_require__(33);\nvar v4 = __webpack_require__(34);\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar uuid_1 = __webpack_require__(3);\nvar aggregate_root_1 = __webpack_require__(29);\nvar events_1 = __webpack_require__(30);\nvar todo_1 = __webpack_require__(31);\n\nvar TodoList = function (_aggregate_root_1$Agg) {\n    _inherits(TodoList, _aggregate_root_1$Agg);\n\n    function TodoList() {\n        _classCallCheck(this, TodoList);\n\n        return _possibleConstructorReturn(this, (TodoList.__proto__ || Object.getPrototypeOf(TodoList)).apply(this, arguments));\n    }\n\n    _createClass(TodoList, [{\n        key: \"init\",\n        value: function init() {\n            _get(TodoList.prototype.__proto__ || Object.getPrototypeOf(TodoList.prototype), \"init\", this).call(this);\n            this._todos = [];\n        }\n        // Domain Event Handlers\n\n    }, {\n        key: \"TodoAdded\",\n        value: function TodoAdded(e) {\n            if (!this.id) {\n                this._id = e.aggregateId;\n            }\n            this._todos.push(new todo_1.Todo(e.todoId, e.todoName));\n        }\n    }, {\n        key: \"TodoRemoved\",\n        value: function TodoRemoved(e) {\n            var i = this._todos.findIndex(function (x) {\n                return x.id === e.todoId;\n            });\n            if (i !== -1) {\n                this._todos.splice(i, 1);\n            }\n        }\n    }, {\n        key: \"TodoCompleted\",\n        value: function TodoCompleted(e) {\n            var i = this._todos.findIndex(function (x) {\n                return x.id === e.todoId;\n            });\n            if (i !== -1) {\n                var oldTodo = this._todos[i];\n                var newTodo = new todo_1.CompletedTodo(oldTodo.id, oldTodo.name, e.todoCompletionTimestamp);\n                this._todos[i] = newTodo;\n            }\n        }\n    }, {\n        key: \"TodoUncompleted\",\n        value: function TodoUncompleted(e) {\n            var i = this._todos.findIndex(function (x) {\n                return x.id === e.todoId;\n            });\n            if (i !== -1) {\n                var oldTodo = this._todos[i];\n                var newTodo = new todo_1.Todo(oldTodo.id, oldTodo.name);\n                this._todos[i] = newTodo;\n            }\n        }\n    }, {\n        key: \"TodoRenamed\",\n        value: function TodoRenamed(e) {\n            var todo = this._todos.find(function (x) {\n                return x.id === e.todoId;\n            });\n            if (todo) {\n                todo.name = e.todoName;\n            }\n        }\n    }, {\n        key: \"TodoPositionChanged\",\n        value: function TodoPositionChanged(e) {\n            var _this2 = this;\n\n            var incompleteTodoPositions = this._todos.reduce(function (p, c, i) {\n                if (!c.isCompleted) {\n                    p.push(i);\n                }\n                return p;\n            }, []);\n            var from = incompleteTodoPositions.findIndex(function (x) {\n                return _this2._todos[x].id === e.todoId;\n            });\n            if (from === -1) {\n                return;\n            }\n            var to = from + e.todoOffset;\n            if (to < 0) {\n                to = 0;\n            } else if (to > incompleteTodoPositions.length - 1) {\n                to = incompleteTodoPositions.length - 1;\n            }\n            if (from === to) {\n                return;\n            }\n            if (to < from) {\n                for (var i = to; i < from; i++) {\n                    arraySwap(this._todos, incompleteTodoPositions[from], incompleteTodoPositions[i]);\n                }\n            } else {\n                for (var _i = to; _i > from; _i--) {\n                    arraySwap(this._todos, incompleteTodoPositions[from], incompleteTodoPositions[_i]);\n                }\n            }\n            function arraySwap(arr, x, y) {\n                var a = arr[x];\n                arr[x] = arr[y];\n                arr[y] = a;\n            }\n        }\n    }, {\n        key: \"add\",\n        value: function add(id, name) {\n            var agId = this.id || uuid_1.v4();\n            this.applyAndStage(new events_1.TodoAdded(agId, id, name));\n        }\n    }, {\n        key: \"remove\",\n        value: function remove(id) {\n            this.applyAndStage(new events_1.TodoRemoved(this.id, id));\n        }\n    }, {\n        key: \"complete\",\n        value: function complete(id, completionTimestamp) {\n            this.applyAndStage(new events_1.TodoCompleted(this.id, id, completionTimestamp));\n        }\n    }, {\n        key: \"uncomplete\",\n        value: function uncomplete(id) {\n            this.applyAndStage(new events_1.TodoUncompleted(this.id, id));\n        }\n    }, {\n        key: \"rename\",\n        value: function rename(id, name) {\n            this.applyAndStage(new events_1.TodoRenamed(this.id, id, name));\n        }\n    }, {\n        key: \"changePosition\",\n        value: function changePosition(id, offset) {\n            this.applyAndStage(new events_1.TodoPositionChanged(this.id, id, offset));\n        }\n    }, {\n        key: \"todos\",\n        get: function get() {\n            return this._todos.filter(function (x) {\n                return !x.isCompleted;\n            });\n        }\n    }, {\n        key: \"completedTodos\",\n        get: function get() {\n            return this._todos.filter(function (x) {\n                return x.isCompleted;\n            }).sort(function (x, y) {\n                return y.completionTimestamp - x.completionTimestamp;\n            });\n        }\n    }]);\n\n    return TodoList;\n}(aggregate_root_1.AggregateRoot);\n\nexports.TodoList = TodoList;\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nfunction historyTodoController(di, todo) {\n    var fragment = todo.isCompleted ? utils_1.templateClone(\"historyCompletedTodoTemplate\") : utils_1.templateClone(\"historyTodoTemplate\");\n    utils_1.fillControllerElements(fragment, \"historyTodoTitlePanelController\", di.historyTodoTitlePanelController(di, todo));\n    return fragment;\n}\nexports.historyTodoController = historyTodoController;\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar event_store_1 = __webpack_require__(2);\nfunction todoListEvents() {\n    // This app's domain and event-store are designed to accommodate multiple aggregates of different types.\n    // Currently, the app only has one aggregate type (TodoList) and only allows the user to have one instance of that aggregate.\n    // This todoLists() lookup occurs to get the aggreateId of the user's one TodoList.\n    return event_store_1.allDomainEvents().then(function (events) {\n        var lists = todoLists(events);\n        return lists.length ? event_store_1.domainEventsByAggregate(lists[0]) : [];\n    });\n}\nexports.todoListEvents = todoListEvents;\nfunction todoLists(events) {\n    return events.reduce(function (p, c) {\n        if (c.type === event_store_1.DomainEventType.TodoAdded && p.indexOf(c.aggregateId) === -1) {\n            p.push(c.aggregateId);\n        }\n        return p;\n    }, []);\n}\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports) {\n\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return  bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports, __webpack_require__) {\n\n/* WEBPACK VAR INJECTION */(function(global) {// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\nvar rng;\n\nvar crypto = global.crypto || global.msCrypto; // for IE 11\nif (crypto && crypto.getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16);\n  rng = function whatwgRNG() {\n    crypto.getRandomValues(rnds8);\n    return rnds8;\n  };\n}\n\nif (!rng) {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var  rnds = new Array(16);\n  rng = function() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n\nmodule.exports = rng;\n\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(35)))\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar uuid_1 = __webpack_require__(3);\nvar app_common_1 = __webpack_require__(1);\nvar todo_list_1 = __webpack_require__(4);\nvar event_store_1 = __webpack_require__(2);\nvar read_1 = __webpack_require__(6);\nvar utils_1 = __webpack_require__(0);\nfunction addTodoFormController(di, todoListId) {\n    var fragment = utils_1.templateClone(\"addTodoFormTemplate\");\n    var addTodoForm = utils_1.findElement(fragment, \"#addTodoForm\");\n    var addTodoInput = utils_1.findElement(addTodoForm, \"#addTodoInput\");\n    $(addTodoInput).on(\"invalid\", app_common_1.invalidNameInputHandler);\n    $(addTodoForm).submit(function (e) {\n        e.preventDefault();\n        // This is to deal with the possibility that the user opens the app for the first time in two tabs\n        // and adds a to-do to each new TodoList. TodoList ids are generated when the first Todo is\n        // added to them. So, on first load, there are no Todos and no TodoLists, and this handler\n        // can't know whether to create a new TodoList or load one that might have been made in another tab.\n        // So, if the current TodoList has no id -- i.e. no todos have been added -- we check if any other\n        // tab has added a new TodoList and use that id.\n        var eventsPromise = todoListId ? event_store_1.domainEventsByAggregate(todoListId) : read_1.todoListEvents();\n        eventsPromise.then(function (events) {\n            var todoList = new todo_list_1.TodoList(events);\n            todoList.add(uuid_1.v4(), addTodoInput.value);\n            addTodoForm.reset();\n            // This assignment is only necessary when the first Todo is added to a new TodoList.\n            todoListId = todoList.id;\n            return event_store_1.postDomainEvents(todoList.uncommittedEvents);\n        }).then(function () {\n            return di.refreshLists(di, todoListId);\n        }).catch(console.log);\n    });\n    return fragment;\n}\nexports.addTodoFormController = addTodoFormController;\n\n/***/ }),\n/* 10 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nfunction bodyController(di, events) {\n    var fragment = utils_1.templateClone(\"bodyTemplate\");\n    utils_1.fillControllerElements(fragment, \"todoListPanelController\", di.todoListPanelController(di, events));\n    utils_1.fillControllerElements(fragment, \"eventListController\", di.eventListController(di, events));\n    return fragment;\n}\nexports.bodyController = bodyController;\n\n/***/ }),\n/* 11 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nfunction completedTodoListController(di, todos) {\n    if (!todos.length) {\n        return document.createDocumentFragment();\n    }\n    var fragment = utils_1.templateClone(\"completedTodoListTemplate\");\n    utils_1.fillControllerElements(fragment, \"todoListController\", di.todoListController(di, todos));\n    return fragment;\n}\nexports.completedTodoListController = completedTodoListController;\n\n/***/ }),\n/* 12 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar uuid_1 = __webpack_require__(3);\nvar app_common_1 = __webpack_require__(1);\nvar utils_1 = __webpack_require__(0);\nvar history_todo_controller_1 = __webpack_require__(5);\nfunction eventListController(di, events) {\n    if (!events.length) {\n        return utils_1.templateClone(\"emptyEventListTemplate\");\n    }\n    var todoListId = events[0].aggregateId;\n    var fragment = utils_1.templateClone(\"eventListTemplate\");\n    var historyDi = Object.assign({}, di);\n    historyDi.todoController = history_todo_controller_1.historyTodoController;\n    var eventListDelegatedEventTarget = utils_1.findElement(fragment, \"#eventListDelegatedEventTarget\");\n    var $eventListDelegatedEventTarget = $(eventListDelegatedEventTarget);\n    $eventListDelegatedEventTarget.on(\"click\", \".event-list-item\", function (e) {\n        var refreshBodyEventNamespace = \".activeEventFocusOut:\" + uuid_1.v4();\n        // This handler will reset the body to the interactive todolist when the user clicks\n        // anywhere in the document outside of the event list.\n        $(document).on(\"click\" + refreshBodyEventNamespace + \" keypress\" + refreshBodyEventNamespace, function (e2) {\n            // Short-circuit when handler is triggered by event that created it\n            // or when isn't an 'enter' keypress\n            // or when the event-list-item contains the click target\n            if (e.originalEvent === e2.originalEvent || e2.type === \"keypress\" && e2.which !== 13 || e.currentTarget.contains(e2.target)) {\n                return;\n            }\n            $(document).off(refreshBodyEventNamespace);\n            if (!eventListDelegatedEventTarget.contains(e2.target)) {\n                di.refreshBody(di, todoListId).catch(console.log);\n            }\n        });\n        var eventId = utils_1.getRequiredAttribute(e.currentTarget, app_common_1.eventIdDataAttrName);\n        var historyEvents = events.slice(0, parseInt(eventId, 10));\n        utils_1.fillControllerElements(document, \"todoListPanelController\", historyDi.historyTodoListPanelController(historyDi, historyEvents));\n    });\n    utils_1.fillControllerElements(fragment, \"eventListGroupController\", di.eventListGroupController(di, events));\n    return fragment;\n}\nexports.eventListController = eventListController;\n\n/***/ }),\n/* 13 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar app_common_1 = __webpack_require__(1);\nvar utils_1 = __webpack_require__(0);\nfunction eventListGroupController(di, events) {\n    if (events.length) {\n        var fragment = document.createDocumentFragment();\n        events.forEach(function (e) {\n            var listItemFragment = utils_1.templateClone(\"eventListItemTemplate\");\n            utils_1.setAttrElements(listItemFragment, app_common_1.eventIdDataAttrName, e.id.toString());\n            utils_1.fillControllerElements(listItemFragment, \"eventTextController\", di.eventTextController(di, e));\n            fragment.appendChild(listItemFragment);\n        });\n        return fragment;\n    } else {\n        var _fragment = utils_1.templateClone(\"emptyEventListTemplate\");\n        return _fragment;\n    }\n}\nexports.eventListGroupController = eventListGroupController;\n\n/***/ }),\n/* 14 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar event_store_1 = __webpack_require__(2);\nfunction eventTextController(di, event) {\n    var fragment = document.createDocumentFragment();\n    fragment.textContent = event.id + \" : \" + event_store_1.DomainEventType[event.type];\n    return fragment;\n}\nexports.eventTextController = eventTextController;\n\n/***/ }),\n/* 15 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar todo_list_1 = __webpack_require__(4);\nvar utils_1 = __webpack_require__(0);\nfunction historyTodoListPanelController(di, events) {\n    var fragment = utils_1.templateClone(\"historyTodoListPanelTemplate\");\n    var todoList = new todo_list_1.TodoList(events);\n    utils_1.fillControllerElements(fragment, \"incompleteTodoListController\", di.incompleteTodoListController(di, todoList.todos));\n    utils_1.fillControllerElements(fragment, \"completedTodoListController\", di.completedTodoListController(di, todoList.completedTodos));\n    return fragment;\n}\nexports.historyTodoListPanelController = historyTodoListPanelController;\n\n/***/ }),\n/* 16 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nfunction historyTodoTitlePanelController(di, todo) {\n    var fragment = utils_1.templateClone(\"historyTodoTitlePanelTemplate\");\n    utils_1.fillControllerElements(fragment, \"todoTitleController\", di.todoTitleController(di, todo));\n    return fragment;\n}\nexports.historyTodoTitlePanelController = historyTodoTitlePanelController;\n\n/***/ }),\n/* 17 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nfunction incompleteTodoListController(di, todos) {\n    if (!todos.length) {\n        return document.createDocumentFragment();\n    }\n    var fragment = utils_1.templateClone(\"incompleteTodoListTemplate\");\n    utils_1.fillControllerElements(fragment, \"todoListController\", di.todoListController(di, todos));\n    return fragment;\n}\nexports.incompleteTodoListController = incompleteTodoListController;\n\n/***/ }),\n/* 18 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar app_common_1 = __webpack_require__(1);\nvar utils_1 = __webpack_require__(0);\nfunction todoActionsPanelButtonsController(di, todo) {\n    var fragment = utils_1.templateClone(\"todoDeleteBtnTemplate\");\n    if (!todo.isCompleted) {\n        fragment.appendChild(utils_1.templateClone(\"todoMoveUpBtnTemplate\"));\n        fragment.appendChild(utils_1.templateClone(\"todoMoveDownBtnTemplate\"));\n    }\n    fragment.appendChild(utils_1.templateClone(\"todoRenameBtnTemplate\"));\n    utils_1.setAttrElements(fragment, app_common_1.todoIdDataAttrName, todo.id);\n    return fragment;\n}\nexports.todoActionsPanelButtonsController = todoActionsPanelButtonsController;\n\n/***/ }),\n/* 19 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nfunction todoActionsPanelController(di, todo) {\n    var fragment = utils_1.templateClone(\"todoActionsPanelTemplate\");\n    utils_1.fillControllerElements(fragment, \"todoTitleController\", di.todoTitleController(di, todo));\n    utils_1.fillControllerElements(fragment, \"todoActionsPanelButtonsController\", di.todoActionsPanelButtonsController(di, todo));\n    return fragment;\n}\nexports.todoActionsPanelController = todoActionsPanelController;\n\n/***/ }),\n/* 20 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar app_common_1 = __webpack_require__(1);\nvar utils_1 = __webpack_require__(0);\nfunction todoController(di, todo) {\n    var fragment = todo.isCompleted ? utils_1.templateClone(\"completedTodoTemplate\") : utils_1.templateClone(\"todoTemplate\");\n    utils_1.setAttrElements(fragment, app_common_1.todoIdDataAttrName, todo.id);\n    utils_1.fillControllerElements(fragment, \"todoTitlePanelController\", di.todoTitlePanelController(di, todo));\n    utils_1.fillControllerElements(fragment, \"todoActionsPanelController\", di.todoActionsPanelController(di, todo));\n    utils_1.fillControllerElements(fragment, \"todoRenamePanelController\", di.todoRenamePanelController(di, todo));\n    return fragment;\n}\nexports.todoController = todoController;\n\n/***/ }),\n/* 21 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nfunction todoListController(di, todos) {\n    var fragment = utils_1.templateClone(\"todoListTemplate\");\n    utils_1.fillControllerElements(fragment, \"todoListGroupController\", di.todoListGroupController(di, todos));\n    return fragment;\n}\nexports.todoListController = todoListController;\n\n/***/ }),\n/* 22 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction todoListGroupController(di, todos) {\n    var fragment = document.createDocumentFragment();\n    var _iteratorNormalCompletion = true;\n    var _didIteratorError = false;\n    var _iteratorError = undefined;\n\n    try {\n        for (var _iterator = todos[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n            var todo = _step.value;\n\n            fragment.appendChild(di.todoController(di, todo));\n        }\n    } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n    } finally {\n        try {\n            if (!_iteratorNormalCompletion && _iterator.return) {\n                _iterator.return();\n            }\n        } finally {\n            if (_didIteratorError) {\n                throw _iteratorError;\n            }\n        }\n    }\n\n    return fragment;\n}\nexports.todoListGroupController = todoListGroupController;\n\n/***/ }),\n/* 23 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar uuid_1 = __webpack_require__(3);\nvar app_common_1 = __webpack_require__(1);\nvar todo_list_1 = __webpack_require__(4);\nvar event_store_1 = __webpack_require__(2);\nvar utils_1 = __webpack_require__(0);\nfunction todoListPanelController(di, events) {\n    var fragment = utils_1.templateClone(\"todoListPanelTemplate\");\n    var todoList = new todo_list_1.TodoList(events);\n    var todoListId = todoList.id;\n    var $todoListDelegatedEventTarget = $(utils_1.findElement(fragment, \"#todolistDelegatedEventTarget\"));\n    $todoListDelegatedEventTarget.on(\"submit\", \".renameTodoForm\", function (e) {\n        e.preventDefault();\n        event_store_1.domainEventsByAggregate(todoListId).then(function (refreshEvents) {\n            var refreshTodoList = new todo_list_1.TodoList(refreshEvents);\n            var todoName = $(e.currentTarget).find(\"input[name='name']\").val();\n            var todoId = utils_1.getRequiredAttribute(e.currentTarget, app_common_1.todoIdDataAttrName);\n            refreshTodoList.rename(todoId, todoName);\n            return event_store_1.postDomainEvents(refreshTodoList.uncommittedEvents);\n        }).then(function () {\n            return di.refreshLists(di, todoListId);\n        }).catch(console.log);\n    });\n    // Need to handle keypress here because the completeTodoBtn is an <a> without an href,\n    // so tabbing to it and pressing enter doesn't trigger a click event like it would with a <button>.\n    // I want completeTodoBtn to act like a <button>, but it has another <button> inside of it (todoActionsBtn),\n    // so browsers and Bootstrap styling wouldn't work if it was a <button> (HTML spec says no interactive content\n    // inside interactive content). By using an <a> with no href I get the a.list-group-item Bootstrap styling.\n    $todoListDelegatedEventTarget.on(\"click keypress\", \".completeTodoBtn\", function (e) {\n        completeTodoBtnHandler(e, true);\n    });\n    $todoListDelegatedEventTarget.on(\"click keypress\", \".uncompleteTodoBtn\", function (e) {\n        completeTodoBtnHandler(e, false);\n    });\n    function completeTodoBtnHandler(e, isComplete) {\n        // only handle \"enter\" keypresses\n        if (e.type === \"keypress\" && e.which !== 13) {\n            return;\n        }\n        // short-circuit if this event has bubbled up from the todoActionsBtn (which is inside (un)complete todo buttons)\n        var todoActionsBtn = $(e.currentTarget).find(\".todoActionsBtn\")[0];\n        if (todoActionsBtn === e.target || $.contains(todoActionsBtn, e.target)) {\n            return;\n        }\n        event_store_1.domainEventsByAggregate(todoListId).then(function (refreshEvents) {\n            var refreshTodoList = new todo_list_1.TodoList(refreshEvents);\n            var todoId = utils_1.getRequiredAttribute(e.currentTarget, app_common_1.todoIdDataAttrName);\n            if (isComplete) {\n                refreshTodoList.complete(todoId, Date.now());\n            } else {\n                refreshTodoList.uncomplete(todoId);\n            }\n            return event_store_1.postDomainEvents(refreshTodoList.uncommittedEvents);\n        }).then(function () {\n            return di.refreshLists(di, todoListId);\n        }).catch(console.log);\n    }\n    $todoListDelegatedEventTarget.on(\"click\", \".moveTodoUpBtn\", function (e) {\n        event_store_1.domainEventsByAggregate(todoListId).then(function (refreshEvents) {\n            var refreshTodoList = new todo_list_1.TodoList(refreshEvents);\n            var todoId = utils_1.getRequiredAttribute(e.currentTarget, app_common_1.todoIdDataAttrName);\n            refreshTodoList.changePosition(todoId, -1);\n            return event_store_1.postDomainEvents(refreshTodoList.uncommittedEvents);\n        }).then(function () {\n            return di.refreshLists(di, todoListId);\n        }).catch(console.log);\n    });\n    $todoListDelegatedEventTarget.on(\"click\", \".moveTodoDownBtn\", function (e) {\n        event_store_1.domainEventsByAggregate(todoListId).then(function (refreshEvents) {\n            var refreshTodoList = new todo_list_1.TodoList(refreshEvents);\n            var todoId = utils_1.getRequiredAttribute(e.currentTarget, app_common_1.todoIdDataAttrName);\n            refreshTodoList.changePosition(todoId, 1);\n            return event_store_1.postDomainEvents(refreshTodoList.uncommittedEvents);\n        }).then(function () {\n            return di.refreshLists(di, todoListId);\n        }).catch(console.log);\n    });\n    $todoListDelegatedEventTarget.on(\"click\", \".deleteTodoBtn\", function (e) {\n        event_store_1.domainEventsByAggregate(todoListId).then(function (refreshEvents) {\n            var refeshTodoList = new todo_list_1.TodoList(refreshEvents);\n            var todoId = utils_1.getRequiredAttribute(e.currentTarget, app_common_1.todoIdDataAttrName);\n            refeshTodoList.remove(todoId);\n            return event_store_1.postDomainEvents(refeshTodoList.uncommittedEvents);\n        }).then(function () {\n            return di.refreshLists(di, todoListId);\n        }).catch(console.log);\n    });\n    $todoListDelegatedEventTarget.on(\"click\", \".todoActionsBtn\", function (e) {\n        var $defaultPanel = $(e.currentTarget).closest(\".todoPanelDefault\");\n        var $actionsPanel = $defaultPanel.next();\n        var $bothPanels = $defaultPanel.add($actionsPanel);\n        var actionsBtnGroup = $actionsPanel.find(\".todoActionsPanelBtnGroup\")[0];\n        var eventNamespace = \"click.todoActionsPanelClose:\" + uuid_1.v4();\n        $bothPanels.toggle();\n        // This handler will close (i.e. toggle) the ActionsPanel when the user clicks anywhere in the document outside of the actionsBtnGroup.\n        // eventNamespace is unique (probably) so each instance of this handler can only detach itself.\n        $(document).on(eventNamespace, function (closeEvent) {\n            // Short-circuit when handler is triggered by event that created it.\n            // This happens because this handler is created in the todolistDelegatedEventTarget handler but attached to the document.\n            // So, when the todolistDelegatedEventTarget handler returns, the click event that triggered it will still bubble to the document.\n            if (e.originalEvent === closeEvent.originalEvent) {\n                return;\n            }\n            if (!$.contains(actionsBtnGroup, closeEvent.target)) {\n                $bothPanels.toggle();\n            }\n            $(document).off(eventNamespace);\n        });\n    });\n    $todoListDelegatedEventTarget.on(\"click\", \".renameTodoBtn\", function (e) {\n        var $actionsPanel = $(e.currentTarget).closest(\".todoActionsPanel\");\n        var $renamePanel = $actionsPanel.next();\n        $actionsPanel.add($renamePanel).toggle();\n        $renamePanel.find(\".renameTodoBtnClickFocusTarget\").first().focus();\n    });\n    $todoListDelegatedEventTarget.on(\"blur\", \".renameTodoForm\", function (e) {\n        if (!(e.relatedTarget && $.contains(e.currentTarget, e.relatedTarget))) {\n            var $renamePanel = $(e.currentTarget).closest(\".todoRenamePanel\");\n            $renamePanel.prev().prev().add($renamePanel).toggle();\n        }\n    });\n    utils_1.fillControllerElements(fragment, \"addTodoFormController\", di.addTodoFormController(di, todoListId));\n    utils_1.fillControllerElements(fragment, \"incompleteTodoListController\", di.incompleteTodoListController(di, todoList.todos));\n    utils_1.fillControllerElements(fragment, \"completedTodoListController\", di.completedTodoListController(di, todoList.completedTodos));\n    return fragment;\n}\nexports.todoListPanelController = todoListPanelController;\n\n/***/ }),\n/* 24 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar app_common_1 = __webpack_require__(1);\nvar utils_1 = __webpack_require__(0);\nfunction todoRenamePanelController(di, todo) {\n    var fragment = utils_1.templateClone(\"todoRenamePanelTemplate\");\n    var input = utils_1.findElement(fragment, \"input[name='name']\");\n    var inputId = input.getAttribute(\"id\");\n    var newInputId = inputId + \"-\" + todo.id;\n    var label = utils_1.findElement(fragment, \"label[for='\" + inputId + \"']\");\n    input.setAttribute(\"id\", newInputId);\n    input.setAttribute(\"value\", todo.name);\n    label.setAttribute(\"for\", newInputId);\n    utils_1.setAttrElements(fragment, app_common_1.todoIdDataAttrName, todo.id);\n    $(input).on(\"invalid\", app_common_1.invalidNameInputHandler);\n    return fragment;\n}\nexports.todoRenamePanelController = todoRenamePanelController;\n\n/***/ }),\n/* 25 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nfunction todoTitleController(di, todo) {\n    var titleFragment = document.createDocumentFragment();\n    titleFragment.textContent = todo.name;\n    if (todo.isCompleted) {\n        var completionDateFragment = utils_1.templateClone(\"todoCompletionDateTemplate\");\n        var date = new Date(todo.completionTimestamp);\n        utils_1.fillContentElements(completionDateFragment, \"completionDate\", date.toLocaleDateString());\n        titleFragment.appendChild(completionDateFragment);\n    }\n    return titleFragment;\n}\nexports.todoTitleController = todoTitleController;\n\n/***/ }),\n/* 26 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nfunction todoTitlePanelController(di, todo) {\n    var fragment = utils_1.templateClone(\"todoTitlePanelTemplate\");\n    utils_1.fillControllerElements(fragment, \"todoTitleController\", di.todoTitleController(di, todo));\n    return fragment;\n}\nexports.todoTitlePanelController = todoTitlePanelController;\n\n/***/ }),\n/* 27 */\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n/* 28 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar app_common_1 = __webpack_require__(1);\nvar add_todo_form_controller_1 = __webpack_require__(9);\nvar body_controller_1 = __webpack_require__(10);\nvar completed_todo_list_controller_1 = __webpack_require__(11);\nvar event_list_controller_1 = __webpack_require__(12);\nvar event_list_group_controller_1 = __webpack_require__(13);\nvar event_text_controller_1 = __webpack_require__(14);\nvar history_todo_controller_1 = __webpack_require__(5);\nvar history_todo_list_panel_controller_1 = __webpack_require__(15);\nvar history_todo_title_panel_controller_1 = __webpack_require__(16);\nvar incomplete_todo_list_controller_1 = __webpack_require__(17);\nvar todo_actions_panel_buttons_controller_1 = __webpack_require__(18);\nvar todo_actions_panel_controller_1 = __webpack_require__(19);\nvar todo_controller_1 = __webpack_require__(20);\nvar todo_list_controller_1 = __webpack_require__(21);\nvar todo_list_group_controller_1 = __webpack_require__(22);\nvar todo_list_panel_controller_1 = __webpack_require__(23);\nvar todo_rename_panel_controller_1 = __webpack_require__(24);\nvar todo_title_controller_1 = __webpack_require__(25);\nvar todo_title_panel_controller_1 = __webpack_require__(26);\nvar read_1 = __webpack_require__(6);\n__webpack_require__(27);\nvar utils_1 = __webpack_require__(0);\nif (!window.indexedDB) {\n    window.alert(\"Your browser doesn't support IndexedDB (the browser feature this app uses to store your To-dos). Update your browser to its latest version.\");\n}\nvar di = {\n    bodyController: body_controller_1.bodyController,\n    todoListPanelController: todo_list_panel_controller_1.todoListPanelController,\n    addTodoFormController: add_todo_form_controller_1.addTodoFormController,\n    incompleteTodoListController: incomplete_todo_list_controller_1.incompleteTodoListController,\n    completedTodoListController: completed_todo_list_controller_1.completedTodoListController,\n    todoListController: todo_list_controller_1.todoListController,\n    todoListGroupController: todo_list_group_controller_1.todoListGroupController,\n    todoController: todo_controller_1.todoController,\n    todoTitlePanelController: todo_title_panel_controller_1.todoTitlePanelController,\n    todoTitleController: todo_title_controller_1.todoTitleController,\n    todoActionsPanelController: todo_actions_panel_controller_1.todoActionsPanelController,\n    todoActionsPanelButtonsController: todo_actions_panel_buttons_controller_1.todoActionsPanelButtonsController,\n    todoRenamePanelController: todo_rename_panel_controller_1.todoRenamePanelController,\n    eventListController: event_list_controller_1.eventListController,\n    eventListGroupController: event_list_group_controller_1.eventListGroupController,\n    eventTextController: event_text_controller_1.eventTextController,\n    refreshLists: app_common_1.refreshLists,\n    refreshBody: app_common_1.refreshBody,\n    historyTodoListPanelController: history_todo_list_panel_controller_1.historyTodoListPanelController,\n    historyTodoController: history_todo_controller_1.historyTodoController,\n    historyTodoTitlePanelController: history_todo_title_panel_controller_1.historyTodoTitlePanelController\n};\nread_1.todoListEvents().then(function (events) {\n    utils_1.fillControllerElements(document, \"bodyController\", di.bodyController(di, events));\n}).catch(console.log);\n\n/***/ }),\n/* 29 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar event_store_1 = __webpack_require__(2);\n\nvar AggregateRoot = function () {\n    _createClass(AggregateRoot, [{\n        key: \"init\",\n        value: function init() {\n            this._uncommittedEvents = new Array();\n        }\n    }, {\n        key: \"uncommittedEvents\",\n        get: function get() {\n            return this._uncommittedEvents;\n        }\n    }, {\n        key: \"id\",\n        get: function get() {\n            return this._id;\n        }\n    }]);\n\n    function AggregateRoot(events) {\n        _classCallCheck(this, AggregateRoot);\n\n        this.init();\n        var _iteratorNormalCompletion = true;\n        var _didIteratorError = false;\n        var _iteratorError = undefined;\n\n        try {\n            for (var _iterator = events[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                var e = _step.value;\n\n                this[event_store_1.DomainEventType[e.type]](e);\n            }\n        } catch (err) {\n            _didIteratorError = true;\n            _iteratorError = err;\n        } finally {\n            try {\n                if (!_iteratorNormalCompletion && _iterator.return) {\n                    _iterator.return();\n                }\n            } finally {\n                if (_didIteratorError) {\n                    throw _iteratorError;\n                }\n            }\n        }\n    }\n\n    _createClass(AggregateRoot, [{\n        key: \"applyAndStage\",\n        value: function applyAndStage(e) {\n            this[event_store_1.DomainEventType[e.type]](e);\n            this._uncommittedEvents.push(e);\n        }\n    }]);\n\n    return AggregateRoot;\n}();\n\nexports.AggregateRoot = AggregateRoot;\n\n/***/ }),\n/* 30 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar event_store_1 = __webpack_require__(2);\n\nvar TodoAdded = function TodoAdded(aggregateId, todoId, todoName) {\n    _classCallCheck(this, TodoAdded);\n\n    this.aggregateId = aggregateId;\n    this.todoId = todoId;\n    this.todoName = todoName;\n    this.type = event_store_1.DomainEventType.TodoAdded;\n};\n\nexports.TodoAdded = TodoAdded;\n\nvar TodoRemoved = function TodoRemoved(aggregateId, todoId) {\n    _classCallCheck(this, TodoRemoved);\n\n    this.aggregateId = aggregateId;\n    this.todoId = todoId;\n    this.type = event_store_1.DomainEventType.TodoRemoved;\n};\n\nexports.TodoRemoved = TodoRemoved;\n\nvar TodoCompleted = function TodoCompleted(aggregateId, todoId, todoCompletionTimestamp) {\n    _classCallCheck(this, TodoCompleted);\n\n    this.aggregateId = aggregateId;\n    this.todoId = todoId;\n    this.todoCompletionTimestamp = todoCompletionTimestamp;\n    this.type = event_store_1.DomainEventType.TodoCompleted;\n};\n\nexports.TodoCompleted = TodoCompleted;\n\nvar TodoUncompleted = function TodoUncompleted(aggregateId, todoId) {\n    _classCallCheck(this, TodoUncompleted);\n\n    this.aggregateId = aggregateId;\n    this.todoId = todoId;\n    this.type = event_store_1.DomainEventType.TodoUncompleted;\n};\n\nexports.TodoUncompleted = TodoUncompleted;\n\nvar TodoRenamed = function TodoRenamed(aggregateId, todoId, todoName) {\n    _classCallCheck(this, TodoRenamed);\n\n    this.aggregateId = aggregateId;\n    this.todoId = todoId;\n    this.todoName = todoName;\n    this.type = event_store_1.DomainEventType.TodoRenamed;\n};\n\nexports.TodoRenamed = TodoRenamed;\n\nvar TodoPositionChanged = function TodoPositionChanged(aggregateId, todoId, todoOffset) {\n    _classCallCheck(this, TodoPositionChanged);\n\n    this.aggregateId = aggregateId;\n    this.todoId = todoId;\n    this.todoOffset = todoOffset;\n    this.type = event_store_1.DomainEventType.TodoPositionChanged;\n};\n\nexports.TodoPositionChanged = TodoPositionChanged;\n\n/***/ }),\n/* 31 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\nvar Todo = function Todo(id, name) {\n    _classCallCheck(this, Todo);\n\n    this.id = id;\n    this.name = name;\n    this.isCompleted = false;\n};\n\nexports.Todo = Todo;\n\nvar CompletedTodo = function (_Todo) {\n    _inherits(CompletedTodo, _Todo);\n\n    function CompletedTodo(id, name, completionTimestamp) {\n        _classCallCheck(this, CompletedTodo);\n\n        var _this = _possibleConstructorReturn(this, (CompletedTodo.__proto__ || Object.getPrototypeOf(CompletedTodo)).call(this, id, name));\n\n        _this.completionTimestamp = completionTimestamp;\n        _this.isCompleted = true;\n        return _this;\n    }\n\n    return CompletedTodo;\n}(Todo);\n\nexports.CompletedTodo = CompletedTodo;\n\n/***/ }),\n/* 32 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      request.onupgradeneeded = function(event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (true) {\n    module.exports = exp;\n    module.exports.default = module.exports;\n  }\n  else {\n    self.idb = exp;\n  }\n}());\n\n\n/***/ }),\n/* 33 */\n/***/ (function(module, exports, __webpack_require__) {\n\n// Unique ID creation requires a high quality random # generator.  We feature\n// detect to determine the best RNG source, normalizing to a function that\n// returns 128-bits of randomness, since that's what's usually required\nvar rng = __webpack_require__(8);\nvar bytesToUuid = __webpack_require__(7);\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\n// random #'s we need to init node and clockseq\nvar _seedBytes = rng();\n\n// Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\nvar _nodeId = [\n  _seedBytes[0] | 0x01,\n  _seedBytes[1], _seedBytes[2], _seedBytes[3], _seedBytes[4], _seedBytes[5]\n];\n\n// Per 4.2.2, randomize (14 bit) clockseq\nvar _clockseq = (_seedBytes[6] << 8 | _seedBytes[7]) & 0x3fff;\n\n// Previous uuid creation time\nvar _lastMSecs = 0, _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  var node = options.node || _nodeId;\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n\n\n/***/ }),\n/* 34 */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar rng = __webpack_require__(8);\nvar bytesToUuid = __webpack_require__(7);\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options == 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n\n\n/***/ }),\n/* 35 */\n/***/ (function(module, exports) {\n\nvar g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// bundle.97ff9928fb72b8a45e86.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 28);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap d27c9f43292f42bc6d5e","export function templateClone(id: string): DocumentFragment {\r\n    let selector = \"template#\" + id;\r\n    let template = document.querySelector(selector) as HTMLTemplateElement | null;\r\n    if (!template) {\r\n        throw new Error(`Document missing required '${selector}' element`);\r\n    }\r\n    let fragment = document.importNode(template.content, true);\r\n    return fragment;\r\n}\r\n\r\nexport function fillControllerElements(parentNode: NodeSelector, controllerName: string, newChild: DocumentFragment): void {\r\n    let elems = findControllerElements(parentNode, controllerName);\r\n    // NodeList isn't iterable on Edge, so you can't use array.forEach()\r\n    Array.prototype.forEach.call(elems, (e: HTMLElement) => {\r\n        e.innerHTML = \"\";\r\n        e.appendChild(newChild);\r\n    });\r\n}\r\n\r\nfunction findControllerElements(parentNode: NodeSelector, controllerName: string): NodeListOf<HTMLElement> {\r\n    let selector = `[data-estd-controller='${controllerName}']`;\r\n    return findAllElements(parentNode, selector) as NodeListOf<HTMLElement>;\r\n}\r\n\r\nexport function fillContentElements(parentNode: NodeSelector, propName: string, content: string): void {\r\n    let elems = findContentElements(parentNode, propName);\r\n    // NodeList isn't iterable on Edge, so you can't use array.forEach()\r\n    Array.prototype.forEach.call(elems, (e: Element) => {\r\n        e.textContent = content;\r\n    });\r\n}\r\n\r\nfunction findContentElements(parentNode: NodeSelector, propName: string): NodeListOf<Element> {\r\n    let selector = `[data-estd-content='${propName}']`;\r\n    return findAllElements(parentNode, selector);\r\n}\r\n\r\nexport function setAttrElements(parentNode: NodeSelector, attrName: string, value: string): void {\r\n    let elems = findAttrElements(parentNode, attrName);\r\n    // NodeList isn't iterable on Edge, so you can't use array.forEach()\r\n    Array.prototype.forEach.call(elems, (e: Element) => {\r\n        e.setAttribute(attrName, value);\r\n    });\r\n}\r\n\r\nfunction findAttrElements(parentNode: NodeSelector, attrName: string): NodeListOf<Element> {\r\n    let selector = `[data-estd-attr='${attrName}']`;\r\n    return findAllElements(parentNode, selector);\r\n}\r\n\r\nexport function findElement(parentNode: NodeSelector, selector: string): Element {\r\n    let element = parentNode.querySelector(selector);\r\n    if (!element) {\r\n        throw new Error(`'${parentNode}' missing required '${selector}' element`);\r\n    }\r\n    return element;\r\n}\r\n\r\nfunction findAllElements(parentNode: NodeSelector, selector: string): NodeListOf<Element> {\r\n    let elements = parentNode.querySelectorAll(selector);\r\n    if (!elements.length) {\r\n        throw new Error(`'${parentNode}' missing required '${selector}' element`);\r\n    }\r\n    return elements;\r\n}\r\n\r\nexport function getRequiredAttribute(element: Element, attributeName: string): string {\r\n    let value = element.getAttribute(attributeName);\r\n    if (!value) {\r\n        throw new Error(`'${element}' missing required '${attributeName}' attribute`);\r\n    }\r\n    return value;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./utils.ts","import { v4 as uuid } from \"uuid\";\r\nimport { Dependencies } from \"./dependencies\";\r\nimport { TodoList } from \"./domain/todo-list\";\r\nimport { AggregateIdType, domainEventsByAggregate } from \"./event-store\";\r\nimport { fillControllerElements } from \"./utils\";\r\n\r\nexport const todoIdDataAttrName = \"data-estd-todo-id\";\r\nexport const eventIdDataAttrName = \"data-estd-event-id\";\r\n\r\nexport function refreshLists(di: Dependencies, todoListId: AggregateIdType): Promise<void> {\r\n    return domainEventsByAggregate(todoListId)\r\n        .then(events => {\r\n            let todoList = new TodoList(events);\r\n            fillControllerElements(document, \"incompleteTodoListController\", di.incompleteTodoListController(di, todoList.todos));\r\n            fillControllerElements(document, \"completedTodoListController\", di.completedTodoListController(di, todoList.completedTodos));\r\n            fillControllerElements(document, \"eventListController\", di.eventListController(di, events));\r\n        });\r\n}\r\n\r\nexport function refreshBody(di: Dependencies, todoListId: AggregateIdType): Promise<void> {\r\n    return domainEventsByAggregate(todoListId)\r\n        .then(events => {\r\n            fillControllerElements(document, \"bodyController\", di.bodyController(di, events));\r\n        });\r\n}\r\n\r\nexport function invalidNameInputHandler(e: JQueryEventObject): void {\r\n    let input = e.currentTarget as HTMLInputElement;\r\n    let $input = $(input);\r\n    let $form = $input.closest(\"form\");\r\n    let $button = $input.next().children(\"button\");\r\n    $form.addClass(\"has-error\");\r\n    $button.removeClass(\"btn-success\").addClass(\"btn-danger\");\r\n\r\n    let validationEventNamespace = \".nameTodoInputValidation:\" + uuid();\r\n    function clearValidation(): void {\r\n        $form.removeClass(\"has-error\");\r\n        $button.removeClass(\"btn-danger\").addClass(\"btn-success\");\r\n        $form.off(validationEventNamespace);\r\n        $input.off(validationEventNamespace);\r\n    }\r\n    $input.on(\"input\" + validationEventNamespace, () => {\r\n        if (input.validity.valid) {\r\n            clearValidation();\r\n        }\r\n    });\r\n    $form.on(\"focusout\" + validationEventNamespace, focusOutEvent => {\r\n        if (!focusOutEvent.currentTarget.contains(focusOutEvent.relatedTarget)) {\r\n            clearValidation();\r\n        }\r\n    });\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./app.common.ts","import idb, { Cursor, DB } from \"idb\";\r\n\r\nexport enum DomainEventType {\r\n    TodoAdded,\r\n    TodoRemoved,\r\n    TodoCompleted,\r\n    TodoUncompleted,\r\n    TodoRenamed,\r\n    TodoPositionChanged,\r\n}\r\nexport type AggregateIdType = string;\r\nexport interface UncommittedDomainEvent {\r\n    readonly aggregateId: AggregateIdType;\r\n    readonly type: DomainEventType;\r\n}\r\nexport interface DomainEvent extends UncommittedDomainEvent {\r\n    readonly id: number;\r\n}\r\nexport interface EventStore {\r\n    getAllDomainEvents(version?: number): Promise<DomainEvent[]>;\r\n    getDomainEventsByAggregate(aggregateId: AggregateIdType, version?: number): Promise<DomainEvent[]>;\r\n    postDomainEvents(events: UncommittedDomainEvent[]): Promise<void>;\r\n}\r\n\r\nconst dbName = \"estd-db\";\r\nconst domainEventStoreName = \"domain-event\";\r\nconst aggregateIdPropName = \"aggregateId\";\r\nconst eventIdPropName = \"id\";\r\n\r\nfunction open(): Promise<DB> {\r\n    return idb.open(dbName, 1, db => {\r\n        switch (db.oldVersion) {\r\n            case 0:\r\n                db.createObjectStore(domainEventStoreName, { autoIncrement: true, keyPath: eventIdPropName })\r\n                    .createIndex(aggregateIdPropName, aggregateIdPropName);\r\n        }\r\n    });\r\n}\r\nexport function allDomainEvents(version?: number): Promise<DomainEvent[]> {\r\n    return open().then(db => {\r\n        let events = [] as DomainEvent[];\r\n        let tx = db.transaction(domainEventStoreName);\r\n        let store = tx.objectStore(domainEventStoreName);\r\n        function cursorCallback(cursor: Cursor): void {\r\n            if (!cursor) {\r\n                return;\r\n            }\r\n            events.push(cursor.value as DomainEvent);\r\n            // tslint:disable-next-line:no-floating-promises\r\n            cursor.continue();\r\n        }\r\n        // iterateCursor() should be replace with usage of openCursor() when \"idb\" decides it is safe to do so.\r\n        if (version) {\r\n            store.iterateCursor(IDBKeyRange.upperBound(version), cursorCallback);\r\n        } else {\r\n            store.iterateCursor(cursorCallback);\r\n        }\r\n        return tx.complete.then(() => events);\r\n    });\r\n}\r\n\r\nexport function domainEventsByAggregate(aggregateId: AggregateIdType, version?: number): Promise<DomainEvent[]> {\r\n    return open().then(db => {\r\n        let events = [] as DomainEvent[];\r\n        let tx = db.transaction(domainEventStoreName);\r\n        let index = tx.objectStore(domainEventStoreName).index(aggregateIdPropName);\r\n        function cursorCallback(cursor: Cursor): void {\r\n            if (!cursor) {\r\n                return;\r\n            }\r\n            let event = cursor.value as DomainEvent;\r\n            if (!version || event.id <= version) {\r\n                events.push(event);\r\n            }\r\n            // tslint:disable-next-line:no-floating-promises\r\n            cursor.continue();\r\n        }\r\n        // iterateCursor() should be replace with usage of openCursor() when \"idb\" decides it is safe to do so.\r\n        index.iterateCursor(cursorCallback);\r\n        return tx.complete.then(() => events);\r\n    });\r\n}\r\nexport function postDomainEvents(events: UncommittedDomainEvent[]): Promise<void> {\r\n    return open().then(db => {\r\n        let tx = db.transaction(domainEventStoreName, \"readwrite\");\r\n        let store = tx.objectStore(domainEventStoreName);\r\n        events.forEach(x => store.add(x));\r\n        return tx.complete;\r\n    });\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./event-store.ts","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/uuid/index.js\n// module id = 3\n// module chunks = 0","import { v4 as uuid } from \"uuid\";\r\nimport { AggregateRoot } from \"./aggregate-root\";\r\nimport { TodoAdded, TodoCompleted, TodoPositionChanged, TodoRemoved, TodoRenamed, TodoUncompleted } from \"./events\";\r\nimport { CompletedTodo, Todo, TodoIdType } from \"./todo\";\r\n\r\nexport class TodoList extends AggregateRoot {\r\n    protected _todos: (Todo | CompletedTodo)[];\r\n    get todos(): Todo[] {\r\n        return this._todos.filter(x => !x.isCompleted);\r\n    }\r\n    get completedTodos(): CompletedTodo[] {\r\n        return (this._todos.filter(x => x.isCompleted) as CompletedTodo[])\r\n            .sort((x, y) => y.completionTimestamp - x.completionTimestamp);\r\n    }\r\n    protected init(): void {\r\n        super.init();\r\n        this._todos = [];\r\n    }\r\n\r\n    // Domain Event Handlers\r\n    protected TodoAdded(e: TodoAdded): void {\r\n        if (!this.id) {\r\n            this._id = e.aggregateId;\r\n        }\r\n        this._todos.push(new Todo(e.todoId, e.todoName));\r\n    }\r\n    protected TodoRemoved(e: TodoRemoved): void {\r\n        let i = this._todos.findIndex(x => x.id === e.todoId);\r\n        if (i !== -1) {\r\n            this._todos.splice(i, 1);\r\n        }\r\n    }\r\n    protected TodoCompleted(e: TodoCompleted): void {\r\n        let i = this._todos.findIndex(x => x.id === e.todoId);\r\n        if (i !== -1) {\r\n            let oldTodo = this._todos[i];\r\n            let newTodo = new CompletedTodo(oldTodo.id, oldTodo.name, e.todoCompletionTimestamp);\r\n            this._todos[i] = newTodo;\r\n        }\r\n    }\r\n    protected TodoUncompleted(e: TodoUncompleted): void {\r\n        let i = this._todos.findIndex(x => x.id === e.todoId);\r\n        if (i !== -1) {\r\n            let oldTodo = this._todos[i];\r\n            let newTodo = new Todo(oldTodo.id, oldTodo.name);\r\n            this._todos[i] = newTodo;\r\n        }\r\n    }\r\n    protected TodoRenamed(e: TodoRenamed): void {\r\n        let todo = this._todos.find(x => x.id === e.todoId);\r\n        if (todo) {\r\n            todo.name = e.todoName;\r\n        }\r\n    }\r\n    protected TodoPositionChanged(e: TodoPositionChanged): void {\r\n        let incompleteTodoPositions: number[] = this._todos.reduce<number[]>((p, c, i) => {\r\n            if (!c.isCompleted) {\r\n                p.push(i);\r\n            }\r\n            return p;\r\n        }, []);\r\n        let from = incompleteTodoPositions.findIndex(x => this._todos[x].id === e.todoId);\r\n        if (from === -1) {\r\n            return;\r\n        }\r\n        let to = from + e.todoOffset;\r\n        if (to < 0) {\r\n            to = 0;\r\n        } else if (to > incompleteTodoPositions.length - 1) {\r\n            to = incompleteTodoPositions.length - 1;\r\n        }\r\n        if (from === to) {\r\n            return;\r\n        }\r\n        if (to < from) {\r\n            for (let i = to; i < from; i++) {\r\n                arraySwap(this._todos, incompleteTodoPositions[from], incompleteTodoPositions[i]);\r\n            }\r\n        } else {\r\n            for (let i = to; i > from; i--) {\r\n                arraySwap(this._todos, incompleteTodoPositions[from], incompleteTodoPositions[i]);\r\n            }\r\n        }\r\n        function arraySwap(arr: any[], x: number, y: number): void {\r\n            let a = arr[x];\r\n            arr[x] = arr[y];\r\n            arr[y] = a;\r\n        }\r\n    }\r\n\r\n    add(id: TodoIdType, name: string): void {\r\n        let agId = this.id || uuid();\r\n        this.applyAndStage(new TodoAdded(agId, id, name));\r\n    }\r\n    remove(id: TodoIdType): void {\r\n        this.applyAndStage(new TodoRemoved(this.id, id));\r\n    }\r\n    complete(id: TodoIdType, completionTimestamp: number): void {\r\n        this.applyAndStage(new TodoCompleted(this.id, id, completionTimestamp));\r\n    }\r\n    uncomplete(id: TodoIdType): void {\r\n        this.applyAndStage(new TodoUncompleted(this.id, id));\r\n    }\r\n    rename(id: TodoIdType, name: string): void {\r\n        this.applyAndStage(new TodoRenamed(this.id, id, name));\r\n    }\r\n    changePosition(id: TodoIdType, offset: number): void {\r\n        this.applyAndStage(new TodoPositionChanged(this.id, id, offset));\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./domain/todo-list.ts","import { Dependencies } from \"../dependencies\";\r\nimport { CompletedTodo, Todo } from \"../domain/todo\";\r\nimport { fillControllerElements, templateClone } from \"../utils\";\r\n\r\nexport function historyTodoController(di: Dependencies, todo: Todo | CompletedTodo): DocumentFragment {\r\n    let fragment = (todo.isCompleted)\r\n        ? templateClone(\"historyCompletedTodoTemplate\")\r\n        : templateClone(\"historyTodoTemplate\");\r\n    fillControllerElements(fragment, \"historyTodoTitlePanelController\", di.historyTodoTitlePanelController(di, todo));\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./controllers/history-todo-controller.ts","import { AggregateIdType, allDomainEvents, DomainEvent, domainEventsByAggregate, DomainEventType } from \"./event-store\";\r\n\r\nexport function todoListEvents(): Promise<DomainEvent[]> {\r\n    // This app's domain and event-store are designed to accommodate multiple aggregates of different types.\r\n    // Currently, the app only has one aggregate type (TodoList) and only allows the user to have one instance of that aggregate.\r\n    // This todoLists() lookup occurs to get the aggreateId of the user's one TodoList.\r\n    return allDomainEvents()\r\n        .then(events => {\r\n            let lists = todoLists(events);\r\n            return (lists.length)\r\n                ? domainEventsByAggregate(lists[0])\r\n                : [];\r\n        });\r\n}\r\n\r\nfunction todoLists(events: DomainEvent[]): AggregateIdType[] {\r\n    return events.reduce<AggregateIdType[]>((p, c) => {\r\n        if (c.type === DomainEventType.TodoAdded && p.indexOf(c.aggregateId) === -1) {\r\n            p.push(c.aggregateId);\r\n        }\r\n        return p;\r\n    }, []);\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./read.ts","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return  bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/uuid/lib/bytesToUuid.js\n// module id = 7\n// module chunks = 0","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\nvar rng;\n\nvar crypto = global.crypto || global.msCrypto; // for IE 11\nif (crypto && crypto.getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16);\n  rng = function whatwgRNG() {\n    crypto.getRandomValues(rnds8);\n    return rnds8;\n  };\n}\n\nif (!rng) {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var  rnds = new Array(16);\n  rng = function() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n\nmodule.exports = rng;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/uuid/lib/rng-browser.js\n// module id = 8\n// module chunks = 0","import { v4 as uuid } from \"uuid\";\r\nimport { invalidNameInputHandler } from \"../app.common\";\r\nimport { Dependencies } from \"../dependencies\";\r\nimport { TodoList } from \"../domain/todo-list\";\r\nimport { AggregateIdType, domainEventsByAggregate, postDomainEvents } from \"../event-store\";\r\nimport { todoListEvents } from \"../read\";\r\nimport { findElement, templateClone } from \"../utils\";\r\n\r\nexport function addTodoFormController(di: Dependencies, todoListId: AggregateIdType): DocumentFragment {\r\n    let fragment = templateClone(\"addTodoFormTemplate\");\r\n    let addTodoForm = findElement(fragment, \"#addTodoForm\") as HTMLFormElement;\r\n    let addTodoInput = findElement(addTodoForm, \"#addTodoInput\") as HTMLInputElement;\r\n    $(addTodoInput).on(\"invalid\", invalidNameInputHandler);\r\n    $(addTodoForm).submit(e => {\r\n        e.preventDefault();\r\n        // This is to deal with the possibility that the user opens the app for the first time in two tabs\r\n        // and adds a to-do to each new TodoList. TodoList ids are generated when the first Todo is\r\n        // added to them. So, on first load, there are no Todos and no TodoLists, and this handler\r\n        // can't know whether to create a new TodoList or load one that might have been made in another tab.\r\n        // So, if the current TodoList has no id -- i.e. no todos have been added -- we check if any other\r\n        // tab has added a new TodoList and use that id.\r\n        let eventsPromise = (todoListId)\r\n            ? domainEventsByAggregate(todoListId)\r\n            : todoListEvents();\r\n        eventsPromise.then((events) => {\r\n            let todoList = new TodoList(events);\r\n            todoList.add(uuid(), addTodoInput.value);\r\n            addTodoForm.reset();\r\n            // This assignment is only necessary when the first Todo is added to a new TodoList.\r\n            todoListId = todoList.id;\r\n            return postDomainEvents(todoList.uncommittedEvents);\r\n        }).then(() => di.refreshLists(di, todoListId))\r\n        .catch(console.log);\r\n    });\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./controllers/add-todo-form-controller.ts","import { Dependencies } from \"../dependencies\";\r\nimport { DomainEvent } from \"../event-store\";\r\nimport { fillControllerElements, templateClone } from \"../utils\";\r\n\r\nexport function bodyController(di: Dependencies, events: DomainEvent[]): DocumentFragment {\r\n    let fragment = templateClone(\"bodyTemplate\");\r\n    fillControllerElements(fragment, \"todoListPanelController\", di.todoListPanelController(di, events));\r\n    fillControllerElements(fragment, \"eventListController\", di.eventListController(di, events));\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./controllers/body-controller.ts","import { Dependencies } from \"../dependencies\";\r\nimport { CompletedTodo } from \"../domain/todo\";\r\nimport { fillControllerElements, templateClone } from \"../utils\";\r\n\r\nexport function completedTodoListController(di: Dependencies, todos: CompletedTodo[]): DocumentFragment {\r\n    if (!todos.length) {\r\n        return document.createDocumentFragment();\r\n    }\r\n    let fragment = templateClone(\"completedTodoListTemplate\");\r\n    fillControllerElements(fragment, \"todoListController\", di.todoListController(di, todos));\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./controllers/completed-todo-list-controller.ts","import { v4 as uuid } from \"uuid\";\r\nimport { eventIdDataAttrName } from \"../app.common\";\r\nimport { Dependencies } from \"../dependencies\";\r\nimport { DomainEvent } from \"../event-store\";\r\nimport { fillControllerElements, findElement, getRequiredAttribute, templateClone } from \"../utils\";\r\nimport { historyTodoController } from \"./history-todo-controller\";\r\n\r\nexport function eventListController(di: Dependencies, events: DomainEvent[]): DocumentFragment {\r\n    if (!events.length) {\r\n        return templateClone(\"emptyEventListTemplate\");\r\n    }\r\n    let todoListId = events[0].aggregateId;\r\n    let fragment = templateClone(\"eventListTemplate\");\r\n    let historyDi = Object.assign({}, di);\r\n    historyDi.todoController = historyTodoController;\r\n    let eventListDelegatedEventTarget = findElement(fragment, \"#eventListDelegatedEventTarget\");\r\n    let $eventListDelegatedEventTarget = $(eventListDelegatedEventTarget);\r\n    $eventListDelegatedEventTarget.on(\"click\", \".event-list-item\", e => {\r\n        let refreshBodyEventNamespace = \".activeEventFocusOut:\" + uuid();\r\n        // This handler will reset the body to the interactive todolist when the user clicks\r\n        // anywhere in the document outside of the event list.\r\n        $(document).on(`click${refreshBodyEventNamespace} keypress${refreshBodyEventNamespace}`, e2 => {\r\n            // Short-circuit when handler is triggered by event that created it\r\n            // or when isn't an 'enter' keypress\r\n            // or when the event-list-item contains the click target\r\n            if (e.originalEvent === e2.originalEvent\r\n                || (e2.type === \"keypress\" && e2.which !== 13)\r\n                || e.currentTarget.contains(e2.target)) {\r\n                return;\r\n            }\r\n            $(document).off(refreshBodyEventNamespace);\r\n            if (!eventListDelegatedEventTarget.contains(e2.target)) {\r\n                di.refreshBody(di, todoListId)\r\n                .catch(console.log);\r\n            }\r\n        });\r\n        let eventId = getRequiredAttribute(e.currentTarget, eventIdDataAttrName);\r\n        let historyEvents = events.slice(0, parseInt(eventId, 10));\r\n        fillControllerElements(document, \"todoListPanelController\", historyDi.historyTodoListPanelController(historyDi, historyEvents));\r\n    });\r\n    fillControllerElements(fragment, \"eventListGroupController\", di.eventListGroupController(di, events));\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./controllers/event-list-controller.ts","import { eventIdDataAttrName } from \"../app.common\";\r\nimport { Dependencies } from \"../dependencies\";\r\nimport { DomainEvent } from \"../event-store\";\r\nimport { fillControllerElements, setAttrElements, templateClone } from \"../utils\";\r\n\r\nexport function eventListGroupController(di: Dependencies, events: DomainEvent[]): DocumentFragment {\r\n    if (events.length) {\r\n        let fragment = document.createDocumentFragment();\r\n        events.forEach(e => {\r\n            let listItemFragment = templateClone(\"eventListItemTemplate\");\r\n            setAttrElements(listItemFragment, eventIdDataAttrName, e.id.toString());\r\n            fillControllerElements(listItemFragment, \"eventTextController\", di.eventTextController(di, e));\r\n            fragment.appendChild(listItemFragment);\r\n        });\r\n        return fragment;\r\n    } else {\r\n        let fragment = templateClone(\"emptyEventListTemplate\");\r\n        return fragment;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./controllers/event-list-group-controller.ts","import { Dependencies } from \"../dependencies\";\r\nimport { DomainEvent, DomainEventType } from \"../event-store\";\r\n\r\nexport function eventTextController(di: Dependencies, event: DomainEvent): DocumentFragment {\r\n    let fragment = document.createDocumentFragment();\r\n    fragment.textContent = `${event.id} : ${DomainEventType[event.type]}`;\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./controllers/event-text-controller.ts","import { Dependencies } from \"../dependencies\";\r\nimport { TodoList } from \"../domain/todo-list\";\r\nimport { DomainEvent } from \"../event-store\";\r\nimport { fillControllerElements, templateClone } from \"../utils\";\r\n\r\nexport function historyTodoListPanelController(di: Dependencies, events: DomainEvent[]): DocumentFragment {\r\n    let fragment = templateClone(\"historyTodoListPanelTemplate\");\r\n    let todoList = new TodoList(events);\r\n    fillControllerElements(fragment, \"incompleteTodoListController\", di.incompleteTodoListController(di, todoList.todos));\r\n    fillControllerElements(fragment, \"completedTodoListController\", di.completedTodoListController(di, todoList.completedTodos));\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./controllers/history-todo-list-panel-controller.ts","import { Dependencies } from \"../dependencies\";\r\nimport { CompletedTodo, Todo } from \"../domain/todo\";\r\nimport { fillControllerElements, templateClone } from \"../utils\";\r\n\r\nexport function historyTodoTitlePanelController(di: Dependencies, todo: Todo | CompletedTodo): DocumentFragment {\r\n    let fragment = templateClone(\"historyTodoTitlePanelTemplate\");\r\n    fillControllerElements(fragment, \"todoTitleController\", di.todoTitleController(di, todo));\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./controllers/history-todo-title-panel-controller.ts","import { Dependencies } from \"../dependencies\";\r\nimport { Todo } from \"../domain/todo\";\r\nimport { fillControllerElements, templateClone } from \"../utils\";\r\n\r\nexport function incompleteTodoListController(di: Dependencies, todos: Todo[]): DocumentFragment {\r\n    if (!todos.length) {\r\n        return document.createDocumentFragment();\r\n    }\r\n    let fragment = templateClone(\"incompleteTodoListTemplate\");\r\n    fillControllerElements(fragment, \"todoListController\", di.todoListController(di, todos));\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./controllers/incomplete-todo-list-controller.ts","import { todoIdDataAttrName } from \"../app.common\";\r\nimport { Dependencies } from \"../dependencies\";\r\nimport { CompletedTodo, Todo } from \"../domain/todo\";\r\nimport { setAttrElements, templateClone } from \"../utils\";\r\n\r\nexport function todoActionsPanelButtonsController(di: Dependencies, todo: Todo | CompletedTodo): DocumentFragment {\r\n    let fragment = templateClone(\"todoDeleteBtnTemplate\");\r\n    if (!todo.isCompleted) {\r\n        fragment.appendChild(templateClone(\"todoMoveUpBtnTemplate\"));\r\n        fragment.appendChild(templateClone(\"todoMoveDownBtnTemplate\"));\r\n    }\r\n    fragment.appendChild(templateClone(\"todoRenameBtnTemplate\"));\r\n    setAttrElements(fragment, todoIdDataAttrName, todo.id);\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./controllers/todo-actions-panel-buttons-controller.ts","import { Dependencies } from \"../dependencies\";\r\nimport { CompletedTodo, Todo } from \"../domain/todo\";\r\nimport { fillControllerElements, templateClone } from \"../utils\";\r\nimport { todoTitleController } from \"./todo-title-controller\";\r\n\r\nexport function todoActionsPanelController(di: Dependencies, todo: Todo | CompletedTodo): DocumentFragment {\r\n    let fragment = templateClone(\"todoActionsPanelTemplate\");\r\n    fillControllerElements(fragment, \"todoTitleController\", di.todoTitleController(di, todo));\r\n    fillControllerElements(fragment, \"todoActionsPanelButtonsController\", di.todoActionsPanelButtonsController(di, todo));\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./controllers/todo-actions-panel-controller.ts","import { todoIdDataAttrName } from \"../app.common\";\r\nimport { Dependencies } from \"../dependencies\";\r\nimport { CompletedTodo, Todo } from \"../domain/todo\";\r\nimport { fillControllerElements, setAttrElements, templateClone } from \"../utils\";\r\n\r\nexport function todoController(di: Dependencies, todo: Todo | CompletedTodo): DocumentFragment {\r\n    let fragment = (todo.isCompleted)\r\n        ? templateClone(\"completedTodoTemplate\")\r\n        : templateClone(\"todoTemplate\");\r\n    setAttrElements(fragment, todoIdDataAttrName, todo.id);\r\n    fillControllerElements(fragment, \"todoTitlePanelController\", di.todoTitlePanelController(di, todo));\r\n    fillControllerElements(fragment, \"todoActionsPanelController\", di.todoActionsPanelController(di, todo));\r\n    fillControllerElements(fragment, \"todoRenamePanelController\", di.todoRenamePanelController(di, todo));\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./controllers/todo-controller.ts","import { Dependencies } from \"../dependencies\";\r\nimport { CompletedTodo, Todo } from \"../domain/todo\";\r\nimport { fillControllerElements, templateClone } from \"../utils\";\r\n\r\nexport function todoListController(di: Dependencies, todos: (Todo | CompletedTodo)[]): DocumentFragment {\r\n    let fragment = templateClone(\"todoListTemplate\");\r\n    fillControllerElements(fragment, \"todoListGroupController\", di.todoListGroupController(di, todos));\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./controllers/todo-list-controller.ts","import { Dependencies } from \"../dependencies\";\r\nimport { CompletedTodo, Todo } from \"../domain/todo\";\r\n\r\nexport function todoListGroupController(di: Dependencies, todos: (Todo | CompletedTodo)[]): DocumentFragment {\r\n    let fragment = document.createDocumentFragment();\r\n    for (const todo of todos) {\r\n        fragment.appendChild(di.todoController(di, todo));\r\n    }\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./controllers/todo-list-group-controller.ts","import { v4 as uuid } from \"uuid\";\r\nimport { todoIdDataAttrName } from \"../app.common\";\r\nimport { Dependencies } from \"../dependencies\";\r\nimport { TodoList } from \"../domain/todo-list\";\r\nimport { AggregateIdType, DomainEvent, domainEventsByAggregate, postDomainEvents } from \"../event-store\";\r\nimport { fillControllerElements, findElement, getRequiredAttribute, templateClone } from \"../utils\";\r\n\r\nexport function todoListPanelController(di: Dependencies, events: DomainEvent[]): DocumentFragment {\r\n    let fragment = templateClone(\"todoListPanelTemplate\");\r\n    let todoList = new TodoList(events);\r\n    let todoListId = todoList.id;\r\n    let $todoListDelegatedEventTarget = $(findElement(fragment, \"#todolistDelegatedEventTarget\"));\r\n    $todoListDelegatedEventTarget.on(\"submit\", \".renameTodoForm\", e => {\r\n        e.preventDefault();\r\n        domainEventsByAggregate(todoListId)\r\n            .then(refreshEvents => {\r\n                let refreshTodoList = new TodoList(refreshEvents);\r\n                let todoName = $(e.currentTarget).find(\"input[name='name']\").val() as string;\r\n                let todoId = getRequiredAttribute(e.currentTarget, todoIdDataAttrName);\r\n                refreshTodoList.rename(todoId, todoName);\r\n                return postDomainEvents(refreshTodoList.uncommittedEvents);\r\n            }).then(() => di.refreshLists(di, todoListId))\r\n            .catch(console.log);\r\n    });\r\n    // Need to handle keypress here because the completeTodoBtn is an <a> without an href,\r\n    // so tabbing to it and pressing enter doesn't trigger a click event like it would with a <button>.\r\n    // I want completeTodoBtn to act like a <button>, but it has another <button> inside of it (todoActionsBtn),\r\n    // so browsers and Bootstrap styling wouldn't work if it was a <button> (HTML spec says no interactive content\r\n    // inside interactive content). By using an <a> with no href I get the a.list-group-item Bootstrap styling.\r\n    $todoListDelegatedEventTarget.on(\"click keypress\", \".completeTodoBtn\", e => {\r\n        completeTodoBtnHandler(e, true);\r\n    });\r\n    $todoListDelegatedEventTarget.on(\"click keypress\", \".uncompleteTodoBtn\", e => {\r\n        completeTodoBtnHandler(e, false);\r\n    });\r\n    function completeTodoBtnHandler(e: JQueryEventObject, isComplete: boolean): void {\r\n        // only handle \"enter\" keypresses\r\n        if (e.type === \"keypress\" && e.which !== 13) {\r\n            return;\r\n        }\r\n        // short-circuit if this event has bubbled up from the todoActionsBtn (which is inside (un)complete todo buttons)\r\n        let todoActionsBtn = $(e.currentTarget).find(\".todoActionsBtn\")[0];\r\n        if (todoActionsBtn === e.target || $.contains(todoActionsBtn, e.target)) {\r\n            return;\r\n        }\r\n        domainEventsByAggregate(todoListId)\r\n            .then(refreshEvents => {\r\n                let refreshTodoList = new TodoList(refreshEvents);\r\n                let todoId = getRequiredAttribute(e.currentTarget, todoIdDataAttrName);\r\n                if (isComplete) {\r\n                    refreshTodoList.complete(todoId, Date.now());\r\n                } else {\r\n                    refreshTodoList.uncomplete(todoId);\r\n                }\r\n                return postDomainEvents(refreshTodoList.uncommittedEvents);\r\n            }).then(() => di.refreshLists(di, todoListId))\r\n            .catch(console.log);\r\n    }\r\n    $todoListDelegatedEventTarget.on(\"click\", \".moveTodoUpBtn\", e => {\r\n        domainEventsByAggregate(todoListId)\r\n            .then(refreshEvents => {\r\n                let refreshTodoList = new TodoList(refreshEvents);\r\n                let todoId = getRequiredAttribute(e.currentTarget, todoIdDataAttrName);\r\n                refreshTodoList.changePosition(todoId, -1);\r\n                return postDomainEvents(refreshTodoList.uncommittedEvents);\r\n            }).then(() => di.refreshLists(di, todoListId))\r\n            .catch(console.log);\r\n    });\r\n    $todoListDelegatedEventTarget.on(\"click\", \".moveTodoDownBtn\", e => {\r\n        domainEventsByAggregate(todoListId)\r\n            .then(refreshEvents => {\r\n                let refreshTodoList = new TodoList(refreshEvents);\r\n                let todoId = getRequiredAttribute(e.currentTarget, todoIdDataAttrName);\r\n                refreshTodoList.changePosition(todoId, 1);\r\n                return postDomainEvents(refreshTodoList.uncommittedEvents);\r\n            }).then(() => di.refreshLists(di, todoListId))\r\n            .catch(console.log);\r\n    });\r\n    $todoListDelegatedEventTarget.on(\"click\", \".deleteTodoBtn\", e => {\r\n        domainEventsByAggregate(todoListId)\r\n            .then(refreshEvents => {\r\n                let refeshTodoList = new TodoList(refreshEvents);\r\n                let todoId = getRequiredAttribute(e.currentTarget, todoIdDataAttrName);\r\n                refeshTodoList.remove(todoId);\r\n                return postDomainEvents(refeshTodoList.uncommittedEvents);\r\n            }).then(() => di.refreshLists(di, todoListId))\r\n            .catch(console.log);\r\n    });\r\n    $todoListDelegatedEventTarget.on(\"click\", \".todoActionsBtn\", e => {\r\n        let $defaultPanel = $(e.currentTarget).closest(\".todoPanelDefault\");\r\n        let $actionsPanel = $defaultPanel.next();\r\n        let $bothPanels = $defaultPanel.add($actionsPanel);\r\n        let actionsBtnGroup = $actionsPanel.find(\".todoActionsPanelBtnGroup\")[0];\r\n        let eventNamespace = \"click.todoActionsPanelClose:\" + uuid();\r\n        $bothPanels.toggle();\r\n\r\n        // This handler will close (i.e. toggle) the ActionsPanel when the user clicks anywhere in the document outside of the actionsBtnGroup.\r\n        // eventNamespace is unique (probably) so each instance of this handler can only detach itself.\r\n        $(document).on(eventNamespace, closeEvent => {\r\n            // Short-circuit when handler is triggered by event that created it.\r\n            // This happens because this handler is created in the todolistDelegatedEventTarget handler but attached to the document.\r\n            // So, when the todolistDelegatedEventTarget handler returns, the click event that triggered it will still bubble to the document.\r\n            if (e.originalEvent === closeEvent.originalEvent) {\r\n                return;\r\n            }\r\n            if (!$.contains(actionsBtnGroup, closeEvent.target)) {\r\n                $bothPanels.toggle();\r\n            }\r\n            $(document).off(eventNamespace);\r\n        });\r\n    });\r\n    $todoListDelegatedEventTarget.on(\"click\", \".renameTodoBtn\", e => {\r\n        let $actionsPanel = $(e.currentTarget).closest(\".todoActionsPanel\");\r\n        let $renamePanel = $actionsPanel.next();\r\n        $actionsPanel.add($renamePanel).toggle();\r\n        $renamePanel.find(\".renameTodoBtnClickFocusTarget\").first().focus();\r\n    });\r\n    $todoListDelegatedEventTarget.on(\"blur\", \".renameTodoForm\", e => {\r\n        if (!(e.relatedTarget && $.contains(e.currentTarget, e.relatedTarget))) {\r\n            let $renamePanel = $(e.currentTarget).closest(\".todoRenamePanel\");\r\n            $renamePanel.prev().prev().add($renamePanel).toggle();\r\n        }\r\n    });\r\n\r\n    fillControllerElements(fragment, \"addTodoFormController\", di.addTodoFormController(di, todoListId));\r\n    fillControllerElements(fragment, \"incompleteTodoListController\", di.incompleteTodoListController(di, todoList.todos));\r\n    fillControllerElements(fragment, \"completedTodoListController\", di.completedTodoListController(di, todoList.completedTodos));\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./controllers/todo-list-panel-controller.ts","import { invalidNameInputHandler, todoIdDataAttrName } from \"../app.common\";\r\nimport { Dependencies } from \"../dependencies\";\r\nimport { CompletedTodo, Todo } from \"../domain/todo\";\r\nimport { findElement, setAttrElements, templateClone } from \"../utils\";\r\n\r\nexport function todoRenamePanelController(di: Dependencies, todo: Todo | CompletedTodo): DocumentFragment {\r\n    let fragment = templateClone(\"todoRenamePanelTemplate\");\r\n    let input = findElement(fragment, \"input[name='name']\");\r\n    let inputId = input.getAttribute(\"id\");\r\n    let newInputId = `${inputId}-${todo.id}`;\r\n    let label = findElement(fragment, `label[for='${inputId}']`);\r\n    input.setAttribute(\"id\", newInputId);\r\n    input.setAttribute(\"value\", todo.name);\r\n    label.setAttribute(\"for\", newInputId);\r\n    setAttrElements(fragment, todoIdDataAttrName, todo.id);\r\n    $(input).on(\"invalid\", invalidNameInputHandler);\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./controllers/todo-rename-panel-controller.ts","import { Dependencies } from \"../dependencies\";\r\nimport { CompletedTodo, Todo } from \"../domain/todo\";\r\nimport { fillContentElements, templateClone } from \"../utils\";\r\n\r\nexport function todoTitleController(di: Dependencies, todo: Todo | CompletedTodo): DocumentFragment {\r\n    let titleFragment = document.createDocumentFragment();\r\n    titleFragment.textContent = todo.name;\r\n    if (todo.isCompleted) {\r\n        let completionDateFragment = templateClone(\"todoCompletionDateTemplate\");\r\n        let date = new Date((todo as CompletedTodo).completionTimestamp);\r\n        fillContentElements(completionDateFragment, \"completionDate\", date.toLocaleDateString());\r\n        titleFragment.appendChild(completionDateFragment);\r\n    }\r\n    return titleFragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./controllers/todo-title-controller.ts","import { Dependencies } from \"../dependencies\";\r\nimport { CompletedTodo, Todo } from \"../domain/todo\";\r\nimport { fillControllerElements, templateClone } from \"../utils\";\r\n\r\nexport function todoTitlePanelController(di: Dependencies, todo: Todo | CompletedTodo): DocumentFragment {\r\n    let fragment = templateClone(\"todoTitlePanelTemplate\");\r\n    fillControllerElements(fragment, \"todoTitleController\", di.todoTitleController(di, todo));\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./controllers/todo-title-panel-controller.ts","import { refreshBody, refreshLists } from \"./app.common\";\r\nimport { addTodoFormController } from \"./controllers/add-todo-form-controller\";\r\nimport { bodyController } from \"./controllers/body-controller\";\r\nimport { completedTodoListController } from \"./controllers/completed-todo-list-controller\";\r\nimport { eventListController } from \"./controllers/event-list-controller\";\r\nimport { eventListGroupController } from \"./controllers/event-list-group-controller\";\r\nimport { eventTextController } from \"./controllers/event-text-controller\";\r\nimport { historyTodoController } from \"./controllers/history-todo-controller\";\r\nimport { historyTodoListPanelController } from \"./controllers/history-todo-list-panel-controller\";\r\nimport { historyTodoTitlePanelController } from \"./controllers/history-todo-title-panel-controller\";\r\nimport { incompleteTodoListController } from \"./controllers/incomplete-todo-list-controller\";\r\nimport { todoActionsPanelButtonsController } from \"./controllers/todo-actions-panel-buttons-controller\";\r\nimport { todoActionsPanelController } from \"./controllers/todo-actions-panel-controller\";\r\nimport { todoController } from \"./controllers/todo-controller\";\r\nimport { todoListController } from \"./controllers/todo-list-controller\";\r\nimport { todoListGroupController } from \"./controllers/todo-list-group-controller\";\r\nimport { todoListPanelController } from \"./controllers/todo-list-panel-controller\";\r\nimport { todoRenamePanelController } from \"./controllers/todo-rename-panel-controller\";\r\nimport { todoTitleController } from \"./controllers/todo-title-controller\";\r\nimport { todoTitlePanelController } from \"./controllers/todo-title-panel-controller\";\r\nimport { Dependencies } from \"./dependencies\";\r\nimport { todoListEvents } from \"./read\";\r\nimport \"./site.css\";\r\nimport { fillControllerElements } from \"./utils\";\r\n\r\nif (!window.indexedDB) {\r\n    window.alert(\"Your browser doesn't support IndexedDB (the browser feature this app uses to store your To-dos). Update your browser to its latest version.\");\r\n}\r\n\r\nconst di: Dependencies = {\r\n    bodyController,\r\n    todoListPanelController,\r\n    addTodoFormController,\r\n    incompleteTodoListController,\r\n    completedTodoListController,\r\n    todoListController,\r\n    todoListGroupController,\r\n    todoController,\r\n    todoTitlePanelController,\r\n    todoTitleController,\r\n    todoActionsPanelController,\r\n    todoActionsPanelButtonsController,\r\n    todoRenamePanelController,\r\n    eventListController,\r\n    eventListGroupController,\r\n    eventTextController,\r\n    refreshLists,\r\n    refreshBody,\r\n    historyTodoListPanelController,\r\n    historyTodoController,\r\n    historyTodoTitlePanelController,\r\n};\r\n\r\ntodoListEvents()\r\n    .then(events => {\r\n        fillControllerElements(document, \"bodyController\", di.bodyController(di, events));\r\n    }).catch(console.log);\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./app.ts","import { AggregateIdType, DomainEvent, DomainEventType, UncommittedDomainEvent } from \"../event-store\";\r\n\r\nexport type DomainEventHandler = (e: UncommittedDomainEvent) => void;\r\n\r\nexport abstract class AggregateRoot {\r\n    [key: string]: any;\r\n    private _uncommittedEvents: UncommittedDomainEvent[];\r\n    get uncommittedEvents(): UncommittedDomainEvent[] {\r\n        return this._uncommittedEvents;\r\n    }\r\n    protected _id: AggregateIdType;\r\n    get id(): AggregateIdType {\r\n        return this._id;\r\n    }\r\n    protected init(): void {\r\n        this._uncommittedEvents = new Array<UncommittedDomainEvent>();\r\n    }\r\n    constructor(events: DomainEvent[]) {\r\n        this.init();\r\n        for (const e of events) {\r\n            (this[DomainEventType[e.type]] as DomainEventHandler)(e);\r\n        }\r\n    }\r\n    protected applyAndStage(e: UncommittedDomainEvent): void {\r\n        (this[DomainEventType[e.type]] as DomainEventHandler)(e);\r\n        this._uncommittedEvents.push(e);\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./domain/aggregate-root.ts","import { AggregateIdType, DomainEventType, UncommittedDomainEvent } from \"../event-store\";\r\nimport { TodoIdType } from \"./todo\";\r\n\r\nexport class TodoAdded implements UncommittedDomainEvent {\r\n    readonly type = DomainEventType.TodoAdded;\r\n    constructor(\r\n        readonly aggregateId: AggregateIdType,\r\n        readonly todoId: TodoIdType,\r\n        readonly todoName: string,\r\n    ) { }\r\n}\r\n\r\nexport class TodoRemoved implements UncommittedDomainEvent {\r\n    readonly type = DomainEventType.TodoRemoved;\r\n    constructor(\r\n        readonly aggregateId: AggregateIdType,\r\n        readonly todoId: TodoIdType,\r\n    ) { }\r\n}\r\n\r\nexport class TodoCompleted implements UncommittedDomainEvent {\r\n    readonly type = DomainEventType.TodoCompleted;\r\n    constructor(\r\n        readonly aggregateId: AggregateIdType,\r\n        readonly todoId: TodoIdType,\r\n        readonly todoCompletionTimestamp: number,\r\n    ) { }\r\n}\r\n\r\nexport class TodoUncompleted implements UncommittedDomainEvent {\r\n    readonly type = DomainEventType.TodoUncompleted;\r\n    constructor(\r\n        readonly aggregateId: AggregateIdType,\r\n        readonly todoId: TodoIdType,\r\n    ) { }\r\n}\r\n\r\nexport class TodoRenamed implements UncommittedDomainEvent {\r\n    readonly type = DomainEventType.TodoRenamed;\r\n    constructor(\r\n        readonly aggregateId: AggregateIdType,\r\n        readonly todoId: TodoIdType,\r\n        readonly todoName: string,\r\n    ) { }\r\n}\r\n\r\nexport class TodoPositionChanged implements UncommittedDomainEvent {\r\n    readonly type = DomainEventType.TodoPositionChanged;\r\n    constructor(\r\n        readonly aggregateId: AggregateIdType,\r\n        readonly todoId: TodoIdType,\r\n        readonly todoOffset: number,\r\n    ) { }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./domain/events.ts","export type TodoIdType = string;\r\n\r\nexport class Todo {\r\n    readonly isCompleted: boolean = false;\r\n    constructor(\r\n        readonly id: TodoIdType,\r\n        public name: string,\r\n    ) { }\r\n}\r\n\r\nexport class CompletedTodo extends Todo {\r\n    readonly isCompleted: boolean = true;\r\n    constructor(\r\n        id: TodoIdType,\r\n        name: string,\r\n        readonly completionTimestamp: number,\r\n    ) {\r\n        super(id, name);\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./domain/todo.ts","'use strict';\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      request.onupgradeneeded = function(event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    module.exports = exp;\n    module.exports.default = module.exports;\n  }\n  else {\n    self.idb = exp;\n  }\n}());\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/idb/lib/idb.js\n// module id = 32\n// module chunks = 0","// Unique ID creation requires a high quality random # generator.  We feature\n// detect to determine the best RNG source, normalizing to a function that\n// returns 128-bits of randomness, since that's what's usually required\nvar rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\n// random #'s we need to init node and clockseq\nvar _seedBytes = rng();\n\n// Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\nvar _nodeId = [\n  _seedBytes[0] | 0x01,\n  _seedBytes[1], _seedBytes[2], _seedBytes[3], _seedBytes[4], _seedBytes[5]\n];\n\n// Per 4.2.2, randomize (14 bit) clockseq\nvar _clockseq = (_seedBytes[6] << 8 | _seedBytes[7]) & 0x3fff;\n\n// Previous uuid creation time\nvar _lastMSecs = 0, _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  var node = options.node || _nodeId;\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/uuid/v1.js\n// module id = 33\n// module chunks = 0","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options == 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/uuid/v4.js\n// module id = 34\n// module chunks = 0","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/global.js\n// module id = 35\n// module chunks = 0"],"sourceRoot":""}