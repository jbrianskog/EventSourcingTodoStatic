{"version":3,"sources":["webpack:///bundle.3ced35bb222da3f4db86.js","webpack:///webpack/bootstrap 7e1f38b0c804626f9303","webpack:///./utils.ts","webpack:///./app.common.ts","webpack:///./event-store.ts","webpack:///./~/uuid/index.js","webpack:///./domain/todo-list.ts","webpack:///./controllers/history-todo-controller.ts","webpack:///./read.ts","webpack:///./~/uuid/lib/bytesToUuid.js","webpack:///./~/uuid/lib/rng-browser.js","webpack:///./controllers/add-todo-form-controller.ts","webpack:///./controllers/body-controller.ts","webpack:///./controllers/completed-todo-list-controller.ts","webpack:///./controllers/event-list-controller.ts","webpack:///./controllers/event-list-group-controller.ts","webpack:///./controllers/event-text-controller.ts","webpack:///./controllers/history-todo-list-panel-controller.ts","webpack:///./controllers/history-todo-title-panel-controller.ts","webpack:///./controllers/incomplete-todo-list-controller.ts","webpack:///./controllers/todo-actions-panel-buttons-controller.ts","webpack:///./controllers/todo-actions-panel-controller.ts","webpack:///./controllers/todo-controller.ts","webpack:///./controllers/todo-list-controller.ts","webpack:///./controllers/todo-list-group-controller.ts","webpack:///./controllers/todo-list-panel-controller.ts","webpack:///./controllers/todo-rename-panel-controller.ts","webpack:///./controllers/todo-title-controller.ts","webpack:///./controllers/todo-title-panel-controller.ts","webpack:///./app.ts","webpack:///./domain/aggregate-root.ts","webpack:///./domain/events.ts","webpack:///./domain/todo.ts","webpack:///./~/idb/lib/idb.js","webpack:///./~/uuid/v1.js","webpack:///./~/uuid/v4.js","webpack:///(webpack)/buildin/global.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","templateClone","id","selector","template","document","querySelector","Error","importNode","content","fillControllerElements","parentNode","controllerName","newChild","elems","findControllerElements","Array","forEach","e","innerHTML","appendChild","findAllElements","fillContentElements","propName","findContentElements","textContent","setAttrElements","attrName","findAttrElements","setAttribute","findElement","element","elements","querySelectorAll","length","getRequiredAttribute","attributeName","getAttribute","refreshLists","di","todoListId","event_store_1","domainEventsByAggregate","then","events","todoList","todo_list_1","TodoList","utils_1","incompleteTodoListController","todos","completedTodoListController","completedTodos","eventListController","refreshBody","bodyController","invalidNameInputHandler","clearValidation","$form","removeClass","$button","addClass","off","validationEventNamespace","$input","input","currentTarget","$","closest","next","children","uuid_1","v4","on","validity","valid","contains","relatedTarget","todoIdDataAttrName","eventIdDataAttrName","open","idb_1","default","dbName","db","oldVersion","createObjectStore","domainEventStoreName","autoIncrement","keyPath","eventIdPropName","createIndex","aggregateIdPropName","allDomainEvents","version","cursorCallback","cursor","push","continue","tx","transaction","store","objectStore","iterateCursor","IDBKeyRange","upperBound","complete","aggregateId","event","index","postDomainEvents","x","add","DomainEventType","v1","uuid","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","writable","setPrototypeOf","__proto__","_createClass","defineProperties","target","props","descriptor","key","protoProps","staticProps","_get","receiver","Function","desc","getOwnPropertyDescriptor","undefined","parent","getPrototypeOf","aggregate_root_1","todo_1","events_1","_aggregate_root_1$Agg","this","apply","arguments","_todos","_id","Todo","todoId","todoName","findIndex","splice","oldTodo","newTodo","CompletedTodo","todoCompletionTimestamp","todo","find","arraySwap","arr","y","a","_this2","incompleteTodoPositions","reduce","isCompleted","from","to","todoOffset","_i","agId","applyAndStage","TodoAdded","TodoRemoved","completionTimestamp","TodoCompleted","TodoUncompleted","TodoRenamed","offset","TodoPositionChanged","filter","sort","AggregateRoot","historyTodoController","fragment","historyTodoTitlePanelController","todoListEvents","lists","todoLists","type","indexOf","bytesToUuid","buf","bth","byteToHex","toString","substr","global","rng","crypto","msCrypto","getRandomValues","rnds8","Uint8Array","rnds","r","Math","random","addTodoFormController","addTodoForm","addTodoInput","app_common_1","submit","preventDefault","read_1","reset","uncommittedEvents","catch","console","log","todoListPanelController","createDocumentFragment","todoListController","historyDi","assign","todoController","history_todo_controller_1","eventListDelegatedEventTarget","refreshBodyEventNamespace","e2","originalEvent","which","eventId","historyEvents","slice","parseInt","historyTodoListPanelController","eventListGroupController","listItemFragment","eventTextController","todoTitleController","todoActionsPanelButtonsController","todoActionsPanelController","todoTitlePanelController","todoRenamePanelController","todoListGroupController","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","done","err","return","completeTodoBtnHandler","isComplete","todoActionsBtn","Date","now","uncomplete","$todoListDelegatedEventTarget","val","rename","changePosition","remove","$defaultPanel","$actionsPanel","$bothPanels","actionsBtnGroup","eventNamespace","toggle","closeEvent","$renamePanel","first","focus","prev","inputId","newInputId","label","titleFragment","completionDateFragment","date","toLocaleDateString","body_controller_1","incomplete_todo_list_controller_1","completed_todo_list_controller_1","todo_list_controller_1","todo_list_group_controller_1","todo_controller_1","todo_title_panel_controller_1","todo_title_controller_1","todo_actions_panel_controller_1","todo_actions_panel_buttons_controller_1","todo_rename_panel_controller_1","event_list_controller_1","event_list_group_controller_1","event_text_controller_1","add_todo_form_controller_1","todo_list_panel_controller_1","history_todo_list_panel_controller_1","history_todo_title_panel_controller_1","window","indexedDB","alert","_this","init","_uncommittedEvents","_Todo","toArray","promisifyRequest","request","Promise","resolve","reject","onsuccess","result","onerror","error","promisifyRequestCall","obj","method","args","promisifyCursorRequestCall","Cursor","proxyProperties","ProxyClass","targetProp","properties","prop","set","proxyRequestMethods","proxyMethods","proxyCursorRequestMethods","Index","_index","_cursor","_request","ObjectStore","_store","Transaction","idbTransaction","_tx","oncomplete","onabort","UpgradeDB","_db","DB","IDBIndex","IDBCursor","methodName","IDBObjectStore","IDBTransaction","IDBDatabase","funcName","replace","callback","nativeObject","getAll","query","count","items","exp","upgradeCallback","onupgradeneeded","delete","options","b","clockseq","_clockseq","msecs","getTime","nsecs","_lastNSecs","dt","_lastMSecs","tl","tmh","node","_nodeId","_seedBytes","ii","g","eval"],"mappings":"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","file":"bundle.3ced35bb222da3f4db86.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 28);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction templateClone(id) {\n    var selector = \"template#\" + id;\n    var template = document.querySelector(selector);\n    if (!template) {\n        throw new Error(\"Document missing required '\" + selector + \"' element\");\n    }\n    var fragment = document.importNode(template.content, true);\n    return fragment;\n}\nexports.templateClone = templateClone;\nfunction fillControllerElements(parentNode, controllerName, newChild) {\n    var elems = findControllerElements(parentNode, controllerName);\n    //NodeList isn't iterable on Edge, so you can't use array.forEach()\n    Array.prototype.forEach.call(elems, function (e) {\n        e.innerHTML = \"\";\n        e.appendChild(newChild);\n    });\n}\nexports.fillControllerElements = fillControllerElements;\nfunction findControllerElements(parentNode, controllerName) {\n    var selector = \"[data-estd-controller='\" + controllerName + \"']\";\n    return findAllElements(parentNode, selector);\n}\nfunction fillContentElements(parentNode, propName, content) {\n    var elems = findContentElements(parentNode, propName);\n    //NodeList isn't iterable on Edge, so you can't use array.forEach()\n    Array.prototype.forEach.call(elems, function (e) {\n        e.textContent = content;\n    });\n}\nexports.fillContentElements = fillContentElements;\nfunction findContentElements(parentNode, propName) {\n    var selector = \"[data-estd-content='\" + propName + \"']\";\n    return findAllElements(parentNode, selector);\n}\nfunction setAttrElements(parentNode, attrName, value) {\n    var elems = findAttrElements(parentNode, attrName);\n    //NodeList isn't iterable on Edge, so you can't use array.forEach()\n    Array.prototype.forEach.call(elems, function (e) {\n        e.setAttribute(attrName, value);\n    });\n}\nexports.setAttrElements = setAttrElements;\nfunction findAttrElements(parentNode, attrName) {\n    var selector = \"[data-estd-attr='\" + attrName + \"']\";\n    return findAllElements(parentNode, selector);\n}\nfunction findElement(parentNode, selector) {\n    var element = parentNode.querySelector(selector);\n    if (!element) {\n        throw new Error(\"'\" + parentNode + \"' missing required '\" + selector + \"' element\");\n    }\n    return element;\n}\nexports.findElement = findElement;\nfunction findAllElements(parentNode, selector) {\n    var elements = parentNode.querySelectorAll(selector);\n    if (!elements.length) {\n        throw new Error(\"'\" + parentNode + \"' missing required '\" + selector + \"' element\");\n    }\n    return elements;\n}\nfunction getRequiredAttribute(element, attributeName) {\n    var value = element.getAttribute(attributeName);\n    if (!value) {\n        throw new Error(\"'\" + element + \"' missing required '\" + attributeName + \"' attribute\");\n    }\n    return value;\n}\nexports.getRequiredAttribute = getRequiredAttribute;\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar event_store_1 = __webpack_require__(2);\nvar todo_list_1 = __webpack_require__(4);\nvar utils_1 = __webpack_require__(0);\nvar uuid_1 = __webpack_require__(3);\nexports.todoIdDataAttrName = \"data-estd-todo-id\";\nexports.eventIdDataAttrName = \"data-estd-event-id\";\nfunction refreshLists(di, todoListId) {\n    return event_store_1.domainEventsByAggregate(todoListId).then(function (events) {\n        var todoList = new todo_list_1.TodoList(events);\n        utils_1.fillControllerElements(document, \"incompleteTodoListController\", di.incompleteTodoListController(di, todoList.todos));\n        utils_1.fillControllerElements(document, \"completedTodoListController\", di.completedTodoListController(di, todoList.completedTodos));\n        utils_1.fillControllerElements(document, \"eventListController\", di.eventListController(di, events));\n    });\n}\nexports.refreshLists = refreshLists;\nfunction refreshBody(di, todoListId) {\n    return event_store_1.domainEventsByAggregate(todoListId).then(function (events) {\n        utils_1.fillControllerElements(document, \"bodyController\", di.bodyController(di, events));\n    });\n}\nexports.refreshBody = refreshBody;\nfunction invalidNameInputHandler(e) {\n    var input = e.currentTarget;\n    var $input = $(input);\n    var $form = $input.closest(\"form\");\n    var $button = $input.next().children(\"button\");\n    $form.addClass(\"has-error\");\n    $button.removeClass(\"btn-success\").addClass(\"btn-danger\");\n    var validationEventNamespace = \".nameTodoInputValidation:\" + uuid_1.v4();\n    function clearValidation() {\n        $form.removeClass(\"has-error\");\n        $button.removeClass(\"btn-danger\").addClass(\"btn-success\");\n        $form.off(validationEventNamespace);\n        $input.off(validationEventNamespace);\n    }\n    $input.on(\"input\" + validationEventNamespace, function (e) {\n        if (input.validity.valid) {\n            clearValidation();\n        }\n    });\n    $form.on(\"focusout\" + validationEventNamespace, function (e) {\n        if (!e.currentTarget.contains(e.relatedTarget)) {\n            clearValidation();\n        }\n    });\n}\nexports.invalidNameInputHandler = invalidNameInputHandler;\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar idb_1 = __webpack_require__(32);\nvar DomainEventType;\n(function (DomainEventType) {\n    DomainEventType[DomainEventType[\"TodoAdded\"] = 0] = \"TodoAdded\";\n    DomainEventType[DomainEventType[\"TodoRemoved\"] = 1] = \"TodoRemoved\";\n    DomainEventType[DomainEventType[\"TodoCompleted\"] = 2] = \"TodoCompleted\";\n    DomainEventType[DomainEventType[\"TodoUncompleted\"] = 3] = \"TodoUncompleted\";\n    DomainEventType[DomainEventType[\"TodoRenamed\"] = 4] = \"TodoRenamed\";\n    DomainEventType[DomainEventType[\"TodoPositionChanged\"] = 5] = \"TodoPositionChanged\";\n})(DomainEventType = exports.DomainEventType || (exports.DomainEventType = {}));\nvar dbName = \"estd-db\";\nvar domainEventStoreName = \"domain-event\";\nvar aggregateIdPropName = \"aggregateId\";\nvar eventIdPropName = \"id\";\nfunction open() {\n    return idb_1.default.open(dbName, 1, function (db) {\n        switch (db.oldVersion) {\n            case 0:\n                db.createObjectStore(domainEventStoreName, { autoIncrement: true, keyPath: eventIdPropName }).createIndex(aggregateIdPropName, aggregateIdPropName);\n        }\n    });\n}\nfunction allDomainEvents(version) {\n    return open().then(function (db) {\n        var events = [];\n        var tx = db.transaction(domainEventStoreName);\n        var store = tx.objectStore(domainEventStoreName);\n        function cursorCallback(cursor) {\n            if (!cursor) return;\n            events.push(cursor.value);\n            cursor.continue();\n        }\n        if (version) {\n            store.iterateCursor(IDBKeyRange.upperBound(version), cursorCallback);\n        } else {\n            store.iterateCursor(cursorCallback);\n        }\n        return tx.complete.then(function () {\n            return events;\n        });\n    });\n}\nexports.allDomainEvents = allDomainEvents;\nfunction domainEventsByAggregate(aggregateId, version) {\n    return open().then(function (db) {\n        var events = [];\n        var tx = db.transaction(domainEventStoreName);\n        var index = tx.objectStore(domainEventStoreName).index(aggregateIdPropName);\n        function cursorCallback(cursor) {\n            if (!cursor) return;\n            var event = cursor.value;\n            if (!version || event.id <= version) {\n                events.push(event);\n            }\n            cursor.continue();\n        }\n        index.iterateCursor(cursorCallback);\n        return tx.complete.then(function () {\n            return events;\n        });\n    });\n}\nexports.domainEventsByAggregate = domainEventsByAggregate;\nfunction postDomainEvents(events) {\n    return open().then(function (db) {\n        var tx = db.transaction(domainEventStoreName, \"readwrite\");\n        var store = tx.objectStore(domainEventStoreName);\n        events.forEach(function (x) {\n            return store.add(x);\n        });\n        return tx.complete;\n    });\n}\nexports.postDomainEvents = postDomainEvents;\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar v1 = __webpack_require__(33);\nvar v4 = __webpack_require__(34);\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar aggregate_root_1 = __webpack_require__(29);\nvar todo_1 = __webpack_require__(31);\nvar events_1 = __webpack_require__(30);\nvar uuid_1 = __webpack_require__(3);\n\nvar TodoList = function (_aggregate_root_1$Agg) {\n    _inherits(TodoList, _aggregate_root_1$Agg);\n\n    function TodoList() {\n        _classCallCheck(this, TodoList);\n\n        return _possibleConstructorReturn(this, (TodoList.__proto__ || Object.getPrototypeOf(TodoList)).apply(this, arguments));\n    }\n\n    _createClass(TodoList, [{\n        key: \"init\",\n        value: function init() {\n            _get(TodoList.prototype.__proto__ || Object.getPrototypeOf(TodoList.prototype), \"init\", this).call(this);\n            this._todos = [];\n        }\n        // Domain Event Handlers\n\n    }, {\n        key: \"TodoAdded\",\n        value: function TodoAdded(e) {\n            if (!this.id) {\n                this._id = e.aggregateId;\n            }\n            this._todos.push(new todo_1.Todo(e.todoId, e.todoName));\n        }\n    }, {\n        key: \"TodoRemoved\",\n        value: function TodoRemoved(e) {\n            var i = this._todos.findIndex(function (x) {\n                return x.id === e.todoId;\n            });\n            if (i !== -1) {\n                this._todos.splice(i, 1);\n            }\n        }\n    }, {\n        key: \"TodoCompleted\",\n        value: function TodoCompleted(e) {\n            var i = this._todos.findIndex(function (x) {\n                return x.id === e.todoId;\n            });\n            if (i !== -1) {\n                var oldTodo = this._todos[i];\n                var newTodo = new todo_1.CompletedTodo(oldTodo.id, oldTodo.name, e.todoCompletionTimestamp);\n                this._todos[i] = newTodo;\n            }\n        }\n    }, {\n        key: \"TodoUncompleted\",\n        value: function TodoUncompleted(e) {\n            var i = this._todos.findIndex(function (x) {\n                return x.id === e.todoId;\n            });\n            if (i !== -1) {\n                var oldTodo = this._todos[i];\n                var newTodo = new todo_1.Todo(oldTodo.id, oldTodo.name);\n                this._todos[i] = newTodo;\n            }\n        }\n    }, {\n        key: \"TodoRenamed\",\n        value: function TodoRenamed(e) {\n            var todo = this._todos.find(function (x) {\n                return x.id === e.todoId;\n            });\n            if (todo) {\n                todo.name = e.todoName;\n            }\n        }\n    }, {\n        key: \"TodoPositionChanged\",\n        value: function TodoPositionChanged(e) {\n            var _this2 = this;\n\n            var incompleteTodoPositions = this._todos.reduce(function (p, c, i) {\n                if (!c.isCompleted) {\n                    p.push(i);\n                }\n                return p;\n            }, new Array());\n            var from = incompleteTodoPositions.findIndex(function (x) {\n                return _this2._todos[x].id === e.todoId;\n            });\n            if (from === -1) {\n                return;\n            }\n            var to = from + e.todoOffset;\n            if (to < 0) {\n                to = 0;\n            } else if (to > incompleteTodoPositions.length - 1) {\n                to = incompleteTodoPositions.length - 1;\n            }\n            if (from === to) {\n                return;\n            }\n            if (to < from) {\n                for (var i = to; i < from; i++) {\n                    arraySwap(this._todos, incompleteTodoPositions[from], incompleteTodoPositions[i]);\n                }\n            } else {\n                for (var _i = to; _i > from; _i--) {\n                    arraySwap(this._todos, incompleteTodoPositions[from], incompleteTodoPositions[_i]);\n                }\n            }\n            function arraySwap(arr, x, y) {\n                var a = arr[x];\n                arr[x] = arr[y];\n                arr[y] = a;\n            }\n        }\n    }, {\n        key: \"add\",\n        value: function add(id, name) {\n            var agId = this.id || uuid_1.v4();\n            this.applyAndStage(new events_1.TodoAdded(agId, id, name));\n        }\n    }, {\n        key: \"remove\",\n        value: function remove(id) {\n            this.applyAndStage(new events_1.TodoRemoved(this.id, id));\n        }\n    }, {\n        key: \"complete\",\n        value: function complete(id, completionTimestamp) {\n            this.applyAndStage(new events_1.TodoCompleted(this.id, id, completionTimestamp));\n        }\n    }, {\n        key: \"uncomplete\",\n        value: function uncomplete(id) {\n            this.applyAndStage(new events_1.TodoUncompleted(this.id, id));\n        }\n    }, {\n        key: \"rename\",\n        value: function rename(id, name) {\n            this.applyAndStage(new events_1.TodoRenamed(this.id, id, name));\n        }\n    }, {\n        key: \"changePosition\",\n        value: function changePosition(id, offset) {\n            this.applyAndStage(new events_1.TodoPositionChanged(this.id, id, offset));\n        }\n    }, {\n        key: \"todos\",\n        get: function get() {\n            return this._todos.filter(function (x) {\n                return !x.isCompleted;\n            });\n        }\n    }, {\n        key: \"completedTodos\",\n        get: function get() {\n            return this._todos.filter(function (x) {\n                return x.isCompleted;\n            }).sort(function (x, y) {\n                return y.completionTimestamp - x.completionTimestamp;\n            });\n        }\n    }]);\n\n    return TodoList;\n}(aggregate_root_1.AggregateRoot);\n\nexports.TodoList = TodoList;\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nfunction historyTodoController(di, todo) {\n    var fragment = todo.isCompleted ? utils_1.templateClone(\"historyCompletedTodoTemplate\") : utils_1.templateClone(\"historyTodoTemplate\");\n    utils_1.fillControllerElements(fragment, \"historyTodoTitlePanelController\", di.historyTodoTitlePanelController(di, todo));\n    return fragment;\n}\nexports.historyTodoController = historyTodoController;\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar event_store_1 = __webpack_require__(2);\nfunction todoListEvents() {\n    // This app's domain and event-store are designed to accommodate multiple aggregates of different types.\n    // Currently, the app only has one aggregate type (TodoList) and only allows the user to have one instance of that aggregate.\n    // This todoLists() lookup occurs to get the aggreateId of the user's one TodoList.\n    return event_store_1.allDomainEvents().then(function (events) {\n        var lists = todoLists(events);\n        return lists.length ? event_store_1.domainEventsByAggregate(lists[0]) : [];\n    });\n}\nexports.todoListEvents = todoListEvents;\nfunction todoLists(events) {\n    return events.reduce(function (p, c) {\n        if (c.type === event_store_1.DomainEventType.TodoAdded && p.indexOf(c.aggregateId) === -1) {\n            p.push(c.aggregateId);\n        }\n        return p;\n    }, []);\n}\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports) {\n\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return  bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports, __webpack_require__) {\n\n/* WEBPACK VAR INJECTION */(function(global) {// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\nvar rng;\n\nvar crypto = global.crypto || global.msCrypto; // for IE 11\nif (crypto && crypto.getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16);\n  rng = function whatwgRNG() {\n    crypto.getRandomValues(rnds8);\n    return rnds8;\n  };\n}\n\nif (!rng) {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var  rnds = new Array(16);\n  rng = function() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n\nmodule.exports = rng;\n\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(35)))\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nvar app_common_1 = __webpack_require__(1);\nvar event_store_1 = __webpack_require__(2);\nvar read_1 = __webpack_require__(6);\nvar uuid_1 = __webpack_require__(3);\nvar todo_list_1 = __webpack_require__(4);\nfunction addTodoFormController(di, todoListId) {\n    var fragment = utils_1.templateClone(\"addTodoFormTemplate\");\n    var addTodoForm = utils_1.findElement(fragment, \"#addTodoForm\");\n    var addTodoInput = utils_1.findElement(addTodoForm, \"#addTodoInput\");\n    $(addTodoInput).on(\"invalid\", app_common_1.invalidNameInputHandler);\n    $(addTodoForm).submit(function (e) {\n        e.preventDefault();\n        // This is to deal with the possibility that the user opens the app for the first time in two tabs\n        // and adds a to-do to each new TodoList. TodoList ids are generated when the first Todo is\n        // added to them. So, on first load, there are no Todos and no TodoLists, and this handler\n        // can't know whether to create a new TodoList or load one that might have been made in another tab.\n        // So, if the current TodoList has no id -- i.e. no todos have been added -- we check if any other\n        // tab has added a new TodoList and use that id.\n        var eventsPromise = todoListId ? event_store_1.domainEventsByAggregate(todoListId) : read_1.todoListEvents();\n        eventsPromise.then(function (events) {\n            var todoList = new todo_list_1.TodoList(events);\n            todoList.add(uuid_1.v4(), addTodoInput.value);\n            addTodoForm.reset();\n            // This assignment is only necessary when the first Todo is added to a new TodoList.\n            todoListId = todoList.id;\n            return event_store_1.postDomainEvents(todoList.uncommittedEvents);\n        }).then(function () {\n            return di.refreshLists(di, todoListId);\n        }).catch(console.log);\n    });\n    return fragment;\n}\nexports.addTodoFormController = addTodoFormController;\n\n/***/ }),\n/* 10 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nfunction bodyController(di, events) {\n    var fragment = utils_1.templateClone(\"bodyTemplate\");\n    utils_1.fillControllerElements(fragment, \"todoListPanelController\", di.todoListPanelController(di, events));\n    utils_1.fillControllerElements(fragment, \"eventListController\", di.eventListController(di, events));\n    return fragment;\n}\nexports.bodyController = bodyController;\n\n/***/ }),\n/* 11 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nfunction completedTodoListController(di, todos) {\n    if (!todos.length) {\n        return document.createDocumentFragment();\n    }\n    var fragment = utils_1.templateClone(\"completedTodoListTemplate\");\n    utils_1.fillControllerElements(fragment, \"todoListController\", di.todoListController(di, todos));\n    return fragment;\n}\nexports.completedTodoListController = completedTodoListController;\n\n/***/ }),\n/* 12 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nvar app_common_1 = __webpack_require__(1);\nvar history_todo_controller_1 = __webpack_require__(5);\nvar uuid_1 = __webpack_require__(3);\nfunction eventListController(di, events) {\n    if (!events.length) {\n        return utils_1.templateClone(\"emptyEventListTemplate\");\n    }\n    var todoListId = events[0].aggregateId;\n    var fragment = utils_1.templateClone(\"eventListTemplate\");\n    var historyDi = Object.assign({}, di);\n    historyDi.todoController = history_todo_controller_1.historyTodoController;\n    var eventListDelegatedEventTarget = utils_1.findElement(fragment, \"#eventListDelegatedEventTarget\");\n    var $eventListDelegatedEventTarget = $(eventListDelegatedEventTarget);\n    $eventListDelegatedEventTarget.on(\"click\", \".event-list-item\", function (e) {\n        var refreshBodyEventNamespace = \".activeEventFocusOut:\" + uuid_1.v4();\n        // This handler will reset the body to the interactive todolist when the user clicks\n        // anywhere in the document outside of the event list.\n        $(document).on(\"click\" + refreshBodyEventNamespace + \" keypress\" + refreshBodyEventNamespace, function (e2) {\n            // Short-circuit when handler is triggered by event that created it\n            // or when isn't an 'enter' keypress\n            // or when the event-list-item contains the click target\n            if (e.originalEvent === e2.originalEvent || e2.type === \"keypress\" && e2.which !== 13 || e.currentTarget.contains(e2.target)) {\n                return;\n            }\n            $(document).off(refreshBodyEventNamespace);\n            if (!eventListDelegatedEventTarget.contains(e2.target)) {\n                di.refreshBody(di, todoListId).catch(console.log);\n            }\n        });\n        var eventId = utils_1.getRequiredAttribute(e.currentTarget, app_common_1.eventIdDataAttrName);\n        var historyEvents = events.slice(0, parseInt(eventId));\n        utils_1.fillControllerElements(document, \"todoListPanelController\", historyDi.historyTodoListPanelController(historyDi, historyEvents));\n    });\n    utils_1.fillControllerElements(fragment, \"eventListGroupController\", di.eventListGroupController(di, events));\n    return fragment;\n}\nexports.eventListController = eventListController;\n\n/***/ }),\n/* 13 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nvar app_common_1 = __webpack_require__(1);\nfunction eventListGroupController(di, events) {\n    if (events.length) {\n        var fragment = document.createDocumentFragment();\n        events.forEach(function (e) {\n            var listItemFragment = utils_1.templateClone(\"eventListItemTemplate\");\n            utils_1.setAttrElements(listItemFragment, app_common_1.eventIdDataAttrName, e.id.toString());\n            utils_1.fillControllerElements(listItemFragment, \"eventTextController\", di.eventTextController(di, e));\n            fragment.appendChild(listItemFragment);\n        });\n        return fragment;\n    } else {\n        var _fragment = utils_1.templateClone(\"emptyEventListTemplate\");\n        return _fragment;\n    }\n}\nexports.eventListGroupController = eventListGroupController;\n\n/***/ }),\n/* 14 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar event_store_1 = __webpack_require__(2);\nfunction eventTextController(di, event) {\n    var fragment = document.createDocumentFragment();\n    fragment.textContent = event.id + \" : \" + event_store_1.DomainEventType[event.type];\n    return fragment;\n}\nexports.eventTextController = eventTextController;\n\n/***/ }),\n/* 15 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nvar todo_list_1 = __webpack_require__(4);\nfunction historyTodoListPanelController(di, events) {\n    var fragment = utils_1.templateClone(\"historyTodoListPanelTemplate\");\n    var todoList = new todo_list_1.TodoList(events);\n    utils_1.fillControllerElements(fragment, \"incompleteTodoListController\", di.incompleteTodoListController(di, todoList.todos));\n    utils_1.fillControllerElements(fragment, \"completedTodoListController\", di.completedTodoListController(di, todoList.completedTodos));\n    return fragment;\n}\nexports.historyTodoListPanelController = historyTodoListPanelController;\n\n/***/ }),\n/* 16 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nfunction historyTodoTitlePanelController(di, todo) {\n    var fragment = utils_1.templateClone(\"historyTodoTitlePanelTemplate\");\n    utils_1.fillControllerElements(fragment, \"todoTitleController\", di.todoTitleController(di, todo));\n    return fragment;\n}\nexports.historyTodoTitlePanelController = historyTodoTitlePanelController;\n\n/***/ }),\n/* 17 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nfunction incompleteTodoListController(di, todos) {\n    if (!todos.length) {\n        return document.createDocumentFragment();\n    }\n    var fragment = utils_1.templateClone(\"incompleteTodoListTemplate\");\n    utils_1.fillControllerElements(fragment, \"todoListController\", di.todoListController(di, todos));\n    return fragment;\n}\nexports.incompleteTodoListController = incompleteTodoListController;\n\n/***/ }),\n/* 18 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nvar app_common_1 = __webpack_require__(1);\nfunction todoActionsPanelButtonsController(di, todo) {\n    var fragment = utils_1.templateClone(\"todoDeleteBtnTemplate\");\n    if (!todo.isCompleted) {\n        fragment.appendChild(utils_1.templateClone(\"todoMoveUpBtnTemplate\"));\n        fragment.appendChild(utils_1.templateClone(\"todoMoveDownBtnTemplate\"));\n    }\n    fragment.appendChild(utils_1.templateClone(\"todoRenameBtnTemplate\"));\n    utils_1.setAttrElements(fragment, app_common_1.todoIdDataAttrName, todo.id);\n    return fragment;\n}\nexports.todoActionsPanelButtonsController = todoActionsPanelButtonsController;\n\n/***/ }),\n/* 19 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nfunction todoActionsPanelController(di, todo) {\n    var fragment = utils_1.templateClone(\"todoActionsPanelTemplate\");\n    utils_1.fillControllerElements(fragment, \"todoTitleController\", di.todoTitleController(di, todo));\n    utils_1.fillControllerElements(fragment, \"todoActionsPanelButtonsController\", di.todoActionsPanelButtonsController(di, todo));\n    return fragment;\n}\nexports.todoActionsPanelController = todoActionsPanelController;\n\n/***/ }),\n/* 20 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nvar app_common_1 = __webpack_require__(1);\nfunction todoController(di, todo) {\n    var fragment = todo.isCompleted ? utils_1.templateClone(\"completedTodoTemplate\") : utils_1.templateClone(\"todoTemplate\");\n    utils_1.setAttrElements(fragment, app_common_1.todoIdDataAttrName, todo.id);\n    utils_1.fillControllerElements(fragment, \"todoTitlePanelController\", di.todoTitlePanelController(di, todo));\n    utils_1.fillControllerElements(fragment, \"todoActionsPanelController\", di.todoActionsPanelController(di, todo));\n    utils_1.fillControllerElements(fragment, \"todoRenamePanelController\", di.todoRenamePanelController(di, todo));\n    return fragment;\n}\nexports.todoController = todoController;\n\n/***/ }),\n/* 21 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nfunction todoListController(di, todos) {\n    var fragment = utils_1.templateClone(\"todoListTemplate\");\n    utils_1.fillControllerElements(fragment, \"todoListGroupController\", di.todoListGroupController(di, todos));\n    return fragment;\n}\nexports.todoListController = todoListController;\n\n/***/ }),\n/* 22 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction todoListGroupController(di, todos) {\n    var fragment = document.createDocumentFragment();\n    var _iteratorNormalCompletion = true;\n    var _didIteratorError = false;\n    var _iteratorError = undefined;\n\n    try {\n        for (var _iterator = todos[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n            var todo = _step.value;\n\n            fragment.appendChild(di.todoController(di, todo));\n        }\n    } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n    } finally {\n        try {\n            if (!_iteratorNormalCompletion && _iterator.return) {\n                _iterator.return();\n            }\n        } finally {\n            if (_didIteratorError) {\n                throw _iteratorError;\n            }\n        }\n    }\n\n    return fragment;\n}\nexports.todoListGroupController = todoListGroupController;\n\n/***/ }),\n/* 23 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar event_store_1 = __webpack_require__(2);\nvar utils_1 = __webpack_require__(0);\nvar todo_list_1 = __webpack_require__(4);\nvar app_common_1 = __webpack_require__(1);\nvar uuid_1 = __webpack_require__(3);\nfunction todoListPanelController(di, events) {\n    var fragment = utils_1.templateClone(\"todoListPanelTemplate\");\n    var todoList = new todo_list_1.TodoList(events);\n    var todoListId = todoList.id;\n    var $todoListDelegatedEventTarget = $(utils_1.findElement(fragment, \"#todolistDelegatedEventTarget\"));\n    $todoListDelegatedEventTarget.on(\"submit\", \".renameTodoForm\", function (e) {\n        e.preventDefault();\n        event_store_1.domainEventsByAggregate(todoListId).then(function (events) {\n            var todoList = new todo_list_1.TodoList(events);\n            var todoName = $(e.currentTarget).find(\"input[name='name']\").val();\n            var todoId = utils_1.getRequiredAttribute(e.currentTarget, app_common_1.todoIdDataAttrName);\n            todoList.rename(todoId, todoName);\n            return event_store_1.postDomainEvents(todoList.uncommittedEvents);\n        }).then(function () {\n            return di.refreshLists(di, todoListId);\n        }).catch(console.log);\n    });\n    // Need to handle keypress here because the completeTodoBtn is an <a> without an href,\n    // so tabbing to it and pressing enter doesn't trigger a click event like it would with a <button>.\n    // I want completeTodoBtn to act like a <button>, but it has another <button> inside of it (todoActionsBtn),\n    // so browsers and Bootstrap styling wouldn't work if it was a <button> (HTML spec says no interactive content\n    // inside interactive content). By using an <a> with no href I get the a.list-group-item Bootstrap styling.\n    $todoListDelegatedEventTarget.on(\"click keypress\", \".completeTodoBtn\", function (e) {\n        completeTodoBtnHandler(e, true);\n    });\n    $todoListDelegatedEventTarget.on(\"click keypress\", \".uncompleteTodoBtn\", function (e) {\n        completeTodoBtnHandler(e, false);\n    });\n    function completeTodoBtnHandler(e, isComplete) {\n        // only handle \"enter\" keypresses\n        if (e.type === \"keypress\" && e.which !== 13) {\n            return;\n        }\n        // short-circuit if this event has bubbled up from the todoActionsBtn (which is inside (un)complete todo buttons)\n        var todoActionsBtn = $(e.currentTarget).find(\".todoActionsBtn\")[0];\n        if (todoActionsBtn === e.target || $.contains(todoActionsBtn, e.target)) {\n            return;\n        }\n        event_store_1.domainEventsByAggregate(todoListId).then(function (events) {\n            var todoList = new todo_list_1.TodoList(events);\n            var todoId = utils_1.getRequiredAttribute(e.currentTarget, app_common_1.todoIdDataAttrName);\n            if (isComplete) {\n                todoList.complete(todoId, Date.now());\n            } else {\n                todoList.uncomplete(todoId);\n            }\n            return event_store_1.postDomainEvents(todoList.uncommittedEvents);\n        }).then(function () {\n            return di.refreshLists(di, todoListId);\n        }).catch(console.log);\n    }\n    $todoListDelegatedEventTarget.on(\"click\", \".moveTodoUpBtn\", function (e) {\n        event_store_1.domainEventsByAggregate(todoListId).then(function (events) {\n            var todoList = new todo_list_1.TodoList(events);\n            var todoId = utils_1.getRequiredAttribute(e.currentTarget, app_common_1.todoIdDataAttrName);\n            todoList.changePosition(todoId, -1);\n            return event_store_1.postDomainEvents(todoList.uncommittedEvents);\n        }).then(function () {\n            return di.refreshLists(di, todoListId);\n        }).catch(console.log);\n    });\n    $todoListDelegatedEventTarget.on(\"click\", \".moveTodoDownBtn\", function (e) {\n        event_store_1.domainEventsByAggregate(todoListId).then(function (events) {\n            var todoList = new todo_list_1.TodoList(events);\n            var todoId = utils_1.getRequiredAttribute(e.currentTarget, app_common_1.todoIdDataAttrName);\n            todoList.changePosition(todoId, 1);\n            return event_store_1.postDomainEvents(todoList.uncommittedEvents);\n        }).then(function () {\n            return di.refreshLists(di, todoListId);\n        }).catch(console.log);\n    });\n    $todoListDelegatedEventTarget.on(\"click\", \".deleteTodoBtn\", function (e) {\n        event_store_1.domainEventsByAggregate(todoListId).then(function (events) {\n            var todoList = new todo_list_1.TodoList(events);\n            var todoId = utils_1.getRequiredAttribute(e.currentTarget, app_common_1.todoIdDataAttrName);\n            todoList.remove(todoId);\n            return event_store_1.postDomainEvents(todoList.uncommittedEvents);\n        }).then(function () {\n            return di.refreshLists(di, todoListId);\n        }).catch(console.log);\n    });\n    $todoListDelegatedEventTarget.on(\"click\", \".todoActionsBtn\", function (e) {\n        var $defaultPanel = $(e.currentTarget).closest(\".todoPanelDefault\"),\n            $actionsPanel = $defaultPanel.next(),\n            $bothPanels = $defaultPanel.add($actionsPanel),\n            actionsBtnGroup = $actionsPanel.find(\".todoActionsPanelBtnGroup\")[0],\n            eventNamespace = \"click.todoActionsPanelClose:\" + uuid_1.v4();\n        $bothPanels.toggle();\n        // This handler will close (i.e. toggle) the ActionsPanel when the user clicks anywhere in the document outside of the actionsBtnGroup.\n        // eventNamespace is unique (probably) so each instance of this handler can only detach itself.\n        $(document).on(eventNamespace, function (closeEvent) {\n            // Short-circuit when handler is triggered by event that created it.\n            // This happens because this handler is created in the todolistDelegatedEventTarget handler but attached to the document.\n            // So, when the todolistDelegatedEventTarget handler returns, the click event that triggered it will still bubble to the document.\n            if (e.originalEvent === closeEvent.originalEvent) {\n                return;\n            }\n            if (!$.contains(actionsBtnGroup, closeEvent.target)) {\n                $bothPanels.toggle();\n            }\n            $(document).off(eventNamespace);\n        });\n    });\n    $todoListDelegatedEventTarget.on(\"click\", \".renameTodoBtn\", function (e) {\n        var $actionsPanel = $(e.currentTarget).closest(\".todoActionsPanel\");\n        var $renamePanel = $actionsPanel.next();\n        $actionsPanel.add($renamePanel).toggle();\n        $renamePanel.find(\".renameTodoBtnClickFocusTarget\").first().focus();\n    });\n    $todoListDelegatedEventTarget.on(\"blur\", \".renameTodoForm\", function (e) {\n        if (!(e.relatedTarget && $.contains(e.currentTarget, e.relatedTarget))) {\n            var $renamePanel = $(e.currentTarget).closest(\".todoRenamePanel\");\n            $renamePanel.prev().prev().add($renamePanel).toggle();\n        }\n    });\n    utils_1.fillControllerElements(fragment, \"addTodoFormController\", di.addTodoFormController(di, todoListId));\n    utils_1.fillControllerElements(fragment, \"incompleteTodoListController\", di.incompleteTodoListController(di, todoList.todos));\n    utils_1.fillControllerElements(fragment, \"completedTodoListController\", di.completedTodoListController(di, todoList.completedTodos));\n    return fragment;\n}\nexports.todoListPanelController = todoListPanelController;\n\n/***/ }),\n/* 24 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nvar app_common_1 = __webpack_require__(1);\nfunction todoRenamePanelController(di, todo) {\n    var fragment = utils_1.templateClone(\"todoRenamePanelTemplate\");\n    var input = utils_1.findElement(fragment, \"input[name='name']\");\n    var inputId = input.getAttribute(\"id\");\n    var newInputId = inputId + \"-\" + todo.id;\n    var label = utils_1.findElement(fragment, \"label[for='\" + inputId + \"']\");\n    input.setAttribute(\"id\", newInputId);\n    input.setAttribute(\"value\", todo.name);\n    label.setAttribute(\"for\", newInputId);\n    utils_1.setAttrElements(fragment, app_common_1.todoIdDataAttrName, todo.id);\n    $(input).on(\"invalid\", app_common_1.invalidNameInputHandler);\n    return fragment;\n}\nexports.todoRenamePanelController = todoRenamePanelController;\n\n/***/ }),\n/* 25 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nfunction todoTitleController(di, todo) {\n    var titleFragment = document.createDocumentFragment();\n    titleFragment.textContent = todo.name;\n    if (todo.isCompleted) {\n        var completionDateFragment = utils_1.templateClone(\"todoCompletionDateTemplate\");\n        var date = new Date(todo.completionTimestamp);\n        utils_1.fillContentElements(completionDateFragment, \"completionDate\", date.toLocaleDateString());\n        titleFragment.appendChild(completionDateFragment);\n    }\n    return titleFragment;\n}\nexports.todoTitleController = todoTitleController;\n\n/***/ }),\n/* 26 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = __webpack_require__(0);\nfunction todoTitlePanelController(di, todo) {\n    var fragment = utils_1.templateClone(\"todoTitlePanelTemplate\");\n    utils_1.fillControllerElements(fragment, \"todoTitleController\", di.todoTitleController(di, todo));\n    return fragment;\n}\nexports.todoTitlePanelController = todoTitlePanelController;\n\n/***/ }),\n/* 27 */\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n/* 28 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__webpack_require__(27);\nvar utils_1 = __webpack_require__(0);\nvar read_1 = __webpack_require__(6);\nvar body_controller_1 = __webpack_require__(10);\nvar incomplete_todo_list_controller_1 = __webpack_require__(17);\nvar completed_todo_list_controller_1 = __webpack_require__(11);\nvar todo_list_controller_1 = __webpack_require__(21);\nvar todo_list_group_controller_1 = __webpack_require__(22);\nvar todo_controller_1 = __webpack_require__(20);\nvar todo_title_panel_controller_1 = __webpack_require__(26);\nvar todo_title_controller_1 = __webpack_require__(25);\nvar todo_actions_panel_controller_1 = __webpack_require__(19);\nvar todo_actions_panel_buttons_controller_1 = __webpack_require__(18);\nvar todo_rename_panel_controller_1 = __webpack_require__(24);\nvar event_list_controller_1 = __webpack_require__(12);\nvar event_list_group_controller_1 = __webpack_require__(13);\nvar event_text_controller_1 = __webpack_require__(14);\nvar add_todo_form_controller_1 = __webpack_require__(9);\nvar todo_list_panel_controller_1 = __webpack_require__(23);\nvar history_todo_list_panel_controller_1 = __webpack_require__(15);\nvar history_todo_controller_1 = __webpack_require__(5);\nvar history_todo_title_panel_controller_1 = __webpack_require__(16);\nvar app_common_1 = __webpack_require__(1);\nif (!window.indexedDB) {\n    window.alert(\"Your browser doesn't support IndexedDB (the browser feature this app uses to store your To-dos). Update your browser to its latest version.\");\n}\nvar di = {\n    bodyController: body_controller_1.bodyController,\n    todoListPanelController: todo_list_panel_controller_1.todoListPanelController,\n    addTodoFormController: add_todo_form_controller_1.addTodoFormController,\n    incompleteTodoListController: incomplete_todo_list_controller_1.incompleteTodoListController,\n    completedTodoListController: completed_todo_list_controller_1.completedTodoListController,\n    todoListController: todo_list_controller_1.todoListController,\n    todoListGroupController: todo_list_group_controller_1.todoListGroupController,\n    todoController: todo_controller_1.todoController,\n    todoTitlePanelController: todo_title_panel_controller_1.todoTitlePanelController,\n    todoTitleController: todo_title_controller_1.todoTitleController,\n    todoActionsPanelController: todo_actions_panel_controller_1.todoActionsPanelController,\n    todoActionsPanelButtonsController: todo_actions_panel_buttons_controller_1.todoActionsPanelButtonsController,\n    todoRenamePanelController: todo_rename_panel_controller_1.todoRenamePanelController,\n    eventListController: event_list_controller_1.eventListController,\n    eventListGroupController: event_list_group_controller_1.eventListGroupController,\n    eventTextController: event_text_controller_1.eventTextController,\n    refreshLists: app_common_1.refreshLists,\n    refreshBody: app_common_1.refreshBody,\n    historyTodoListPanelController: history_todo_list_panel_controller_1.historyTodoListPanelController,\n    historyTodoController: history_todo_controller_1.historyTodoController,\n    historyTodoTitlePanelController: history_todo_title_panel_controller_1.historyTodoTitlePanelController\n};\nread_1.todoListEvents().then(function (events) {\n    utils_1.fillControllerElements(document, \"bodyController\", di.bodyController(di, events));\n}).catch(console.log);\n\n/***/ }),\n/* 29 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar event_store_1 = __webpack_require__(2);\n\nvar AggregateRoot = function () {\n    _createClass(AggregateRoot, [{\n        key: \"init\",\n        value: function init() {\n            this._uncommittedEvents = new Array();\n        }\n    }, {\n        key: \"uncommittedEvents\",\n        get: function get() {\n            return this._uncommittedEvents;\n        }\n    }, {\n        key: \"id\",\n        get: function get() {\n            return this._id;\n        }\n    }]);\n\n    function AggregateRoot(events) {\n        var _this = this;\n\n        _classCallCheck(this, AggregateRoot);\n\n        this.init();\n        events.forEach(function (e) {\n            _this[event_store_1.DomainEventType[e.type]](e);\n        });\n    }\n\n    _createClass(AggregateRoot, [{\n        key: \"applyAndStage\",\n        value: function applyAndStage(e) {\n            this[event_store_1.DomainEventType[e.type]](e);\n            this._uncommittedEvents.push(e);\n        }\n    }]);\n\n    return AggregateRoot;\n}();\n\nexports.AggregateRoot = AggregateRoot;\n\n/***/ }),\n/* 30 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar event_store_1 = __webpack_require__(2);\n\nvar TodoAdded = function TodoAdded(aggregateId, todoId, todoName) {\n    _classCallCheck(this, TodoAdded);\n\n    this.aggregateId = aggregateId;\n    this.todoId = todoId;\n    this.todoName = todoName;\n    this.type = event_store_1.DomainEventType.TodoAdded;\n};\n\nexports.TodoAdded = TodoAdded;\n\nvar TodoRemoved = function TodoRemoved(aggregateId, todoId) {\n    _classCallCheck(this, TodoRemoved);\n\n    this.aggregateId = aggregateId;\n    this.todoId = todoId;\n    this.type = event_store_1.DomainEventType.TodoRemoved;\n};\n\nexports.TodoRemoved = TodoRemoved;\n\nvar TodoCompleted = function TodoCompleted(aggregateId, todoId, todoCompletionTimestamp) {\n    _classCallCheck(this, TodoCompleted);\n\n    this.aggregateId = aggregateId;\n    this.todoId = todoId;\n    this.todoCompletionTimestamp = todoCompletionTimestamp;\n    this.type = event_store_1.DomainEventType.TodoCompleted;\n};\n\nexports.TodoCompleted = TodoCompleted;\n\nvar TodoUncompleted = function TodoUncompleted(aggregateId, todoId) {\n    _classCallCheck(this, TodoUncompleted);\n\n    this.aggregateId = aggregateId;\n    this.todoId = todoId;\n    this.type = event_store_1.DomainEventType.TodoUncompleted;\n};\n\nexports.TodoUncompleted = TodoUncompleted;\n\nvar TodoRenamed = function TodoRenamed(aggregateId, todoId, todoName) {\n    _classCallCheck(this, TodoRenamed);\n\n    this.aggregateId = aggregateId;\n    this.todoId = todoId;\n    this.todoName = todoName;\n    this.type = event_store_1.DomainEventType.TodoRenamed;\n};\n\nexports.TodoRenamed = TodoRenamed;\n\nvar TodoPositionChanged = function TodoPositionChanged(aggregateId, todoId, todoOffset) {\n    _classCallCheck(this, TodoPositionChanged);\n\n    this.aggregateId = aggregateId;\n    this.todoId = todoId;\n    this.todoOffset = todoOffset;\n    this.type = event_store_1.DomainEventType.TodoPositionChanged;\n};\n\nexports.TodoPositionChanged = TodoPositionChanged;\n\n/***/ }),\n/* 31 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\nvar Todo = function Todo(id, name) {\n    _classCallCheck(this, Todo);\n\n    this.id = id;\n    this.name = name;\n    this.isCompleted = false;\n};\n\nexports.Todo = Todo;\n\nvar CompletedTodo = function (_Todo) {\n    _inherits(CompletedTodo, _Todo);\n\n    function CompletedTodo(id, name, completionTimestamp) {\n        _classCallCheck(this, CompletedTodo);\n\n        var _this = _possibleConstructorReturn(this, (CompletedTodo.__proto__ || Object.getPrototypeOf(CompletedTodo)).call(this, id, name));\n\n        _this.completionTimestamp = completionTimestamp;\n        _this.isCompleted = true;\n        return _this;\n    }\n\n    return CompletedTodo;\n}(Todo);\n\nexports.CompletedTodo = CompletedTodo;\n\n/***/ }),\n/* 32 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      request.onupgradeneeded = function(event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (true) {\n    module.exports = exp;\n    module.exports.default = module.exports;\n  }\n  else {\n    self.idb = exp;\n  }\n}());\n\n\n/***/ }),\n/* 33 */\n/***/ (function(module, exports, __webpack_require__) {\n\n// Unique ID creation requires a high quality random # generator.  We feature\n// detect to determine the best RNG source, normalizing to a function that\n// returns 128-bits of randomness, since that's what's usually required\nvar rng = __webpack_require__(8);\nvar bytesToUuid = __webpack_require__(7);\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\n// random #'s we need to init node and clockseq\nvar _seedBytes = rng();\n\n// Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\nvar _nodeId = [\n  _seedBytes[0] | 0x01,\n  _seedBytes[1], _seedBytes[2], _seedBytes[3], _seedBytes[4], _seedBytes[5]\n];\n\n// Per 4.2.2, randomize (14 bit) clockseq\nvar _clockseq = (_seedBytes[6] << 8 | _seedBytes[7]) & 0x3fff;\n\n// Previous uuid creation time\nvar _lastMSecs = 0, _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  var node = options.node || _nodeId;\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n\n\n/***/ }),\n/* 34 */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar rng = __webpack_require__(8);\nvar bytesToUuid = __webpack_require__(7);\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options == 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n\n\n/***/ }),\n/* 35 */\n/***/ (function(module, exports) {\n\nvar g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// bundle.3ced35bb222da3f4db86.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 28);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 7e1f38b0c804626f9303","export function templateClone(id: string): DocumentFragment {\r\n    let selector = \"template#\" + id;\r\n    let template = document.querySelector(selector) as HTMLTemplateElement | null;\r\n    if (!template) {\r\n        throw new Error(`Document missing required '${selector}' element`);\r\n    }\r\n    let fragment = document.importNode(template.content, true);\r\n    return fragment;\r\n}\r\n\r\nexport function fillControllerElements(parentNode: NodeSelector, controllerName: string, newChild: DocumentFragment): void {\r\n    let elems = findControllerElements(parentNode, controllerName);\r\n    //NodeList isn't iterable on Edge, so you can't use array.forEach()\r\n    Array.prototype.forEach.call(elems, function (e: HTMLElement) {\r\n        e.innerHTML = \"\";\r\n        e.appendChild(newChild);\r\n    });\r\n}\r\n\r\nfunction findControllerElements(parentNode: NodeSelector, controllerName: string): NodeListOf<HTMLElement> {\r\n    let selector = `[data-estd-controller='${controllerName}']`;\r\n    return findAllElements(parentNode, selector) as NodeListOf<HTMLElement>;\r\n}\r\n\r\nexport function fillContentElements(parentNode: NodeSelector, propName: string, content: string): void {\r\n    let elems = findContentElements(parentNode, propName);\r\n    //NodeList isn't iterable on Edge, so you can't use array.forEach()\r\n    Array.prototype.forEach.call(elems, function (e: Element) {\r\n        e.textContent = content;\r\n    });\r\n}\r\n\r\nfunction findContentElements(parentNode: NodeSelector, propName: string): NodeListOf<Element> {\r\n    let selector = `[data-estd-content='${propName}']`;\r\n    return findAllElements(parentNode, selector);\r\n}\r\n\r\nexport function setAttrElements(parentNode: NodeSelector, attrName: string, value: string): void {\r\n    let elems = findAttrElements(parentNode, attrName);\r\n    //NodeList isn't iterable on Edge, so you can't use array.forEach()\r\n    Array.prototype.forEach.call(elems, function (e: Element) {\r\n        e.setAttribute(attrName, value);\r\n    });\r\n}\r\n\r\nfunction findAttrElements(parentNode: NodeSelector, attrName: string): NodeListOf<Element> {\r\n    let selector = `[data-estd-attr='${attrName}']`;\r\n    return findAllElements(parentNode, selector);\r\n}\r\n\r\nexport function findElement(parentNode: NodeSelector, selector: string): Element {\r\n    let element = parentNode.querySelector(selector);\r\n    if (!element) {\r\n        throw new Error(`'${parentNode}' missing required '${selector}' element`);\r\n    }\r\n    return element;\r\n}\r\n\r\nfunction findAllElements(parentNode: NodeSelector, selector: string): NodeListOf<Element> {\r\n    let elements = parentNode.querySelectorAll(selector);\r\n    if (!elements.length) {\r\n        throw new Error(`'${parentNode}' missing required '${selector}' element`);\r\n    }\r\n    return elements;\r\n}\r\n\r\nexport function getRequiredAttribute(element: Element, attributeName: string): string {\r\n    let value = element.getAttribute(attributeName);\r\n    if (!value) {\r\n        throw new Error(`'${element}' missing required '${attributeName}' attribute`);\r\n    }\r\n    return value;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./utils.ts","import { Dependencies } from \"./dependencies\";\r\nimport { AggregateIdType, domainEventsByAggregate } from \"./event-store\";\r\nimport { TodoList } from \"./domain/todo-list\";\r\nimport { fillControllerElements } from \"./utils\";\r\nimport { v4 as uuid } from \"uuid\";\r\n\r\nexport const todoIdDataAttrName = \"data-estd-todo-id\";\r\nexport const eventIdDataAttrName = \"data-estd-event-id\";\r\n\r\nexport function refreshLists(di: Dependencies, todoListId: AggregateIdType): Promise<void> {\r\n    return domainEventsByAggregate(todoListId)\r\n        .then(events => {\r\n            let todoList = new TodoList(events);\r\n            fillControllerElements(document, \"incompleteTodoListController\", di.incompleteTodoListController(di, todoList.todos));\r\n            fillControllerElements(document, \"completedTodoListController\", di.completedTodoListController(di, todoList.completedTodos));\r\n            fillControllerElements(document, \"eventListController\", di.eventListController(di, events));\r\n        });\r\n}\r\n\r\nexport function refreshBody(di: Dependencies, todoListId: AggregateIdType): Promise<void> {\r\n    return domainEventsByAggregate(todoListId)\r\n        .then(events => {\r\n            fillControllerElements(document, \"bodyController\", di.bodyController(di, events));\r\n        });\r\n}\r\n\r\nexport function invalidNameInputHandler(e: JQueryEventObject) {\r\n    let input = e.currentTarget as HTMLInputElement;\r\n    let $input = $(input);\r\n    let $form = $input.closest(\"form\");\r\n    let $button = $input.next().children(\"button\");\r\n    $form.addClass(\"has-error\");\r\n    $button.removeClass(\"btn-success\").addClass(\"btn-danger\");\r\n\r\n    let validationEventNamespace = \".nameTodoInputValidation:\" + uuid();\r\n    function clearValidation() {\r\n        $form.removeClass(\"has-error\");\r\n        $button.removeClass(\"btn-danger\").addClass(\"btn-success\");\r\n        $form.off(validationEventNamespace);\r\n        $input.off(validationEventNamespace);\r\n    }\r\n    $input.on(\"input\" + validationEventNamespace, function (e) {\r\n        if (input.validity.valid) {\r\n            clearValidation();\r\n        }\r\n    });\r\n    $form.on(\"focusout\" + validationEventNamespace, function (e) {\r\n        if (!e.currentTarget.contains(e.relatedTarget)) {\r\n            clearValidation();\r\n        }\r\n    });\r\n}\n\n\n// WEBPACK FOOTER //\n// ./app.common.ts","import idb, { DB, Cursor } from \"idb\";\r\n\r\nexport enum DomainEventType {\r\n    TodoAdded,\r\n    TodoRemoved,\r\n    TodoCompleted,\r\n    TodoUncompleted,\r\n    TodoRenamed,\r\n    TodoPositionChanged\r\n}\r\nexport type AggregateIdType = string;\r\nexport interface UncommittedDomainEvent {\r\n    readonly aggregateId: AggregateIdType;\r\n    readonly type: DomainEventType;\r\n}\r\nexport interface DomainEvent extends UncommittedDomainEvent {\r\n    readonly id: number;\r\n}\r\nexport interface EventStore {\r\n    getAllDomainEvents(version?: number): Promise<DomainEvent[]>;\r\n    getDomainEventsByAggregate(aggregateId: AggregateIdType, version?: number): Promise<DomainEvent[]>;\r\n    postDomainEvents(events: UncommittedDomainEvent[]): Promise<void>;\r\n}\r\n\r\nconst dbName = \"estd-db\";\r\nconst domainEventStoreName = \"domain-event\";\r\nconst aggregateIdPropName = \"aggregateId\";\r\nconst eventIdPropName = \"id\";\r\n\r\nfunction open(): Promise<DB> {\r\n    return idb.open(dbName, 1, db => {\r\n        switch (db.oldVersion) {\r\n            case 0:\r\n                db.createObjectStore(domainEventStoreName, { autoIncrement: true, keyPath: eventIdPropName })\r\n                    .createIndex(aggregateIdPropName, aggregateIdPropName);\r\n        }\r\n    });\r\n}\r\nexport function allDomainEvents(version?: number): Promise<DomainEvent[]> {\r\n    return open().then(db => {\r\n        let events = [] as DomainEvent[];\r\n        let tx = db.transaction(domainEventStoreName);\r\n        let store = tx.objectStore(domainEventStoreName);\r\n        function cursorCallback(cursor: Cursor) {\r\n            if (!cursor) return;\r\n            events.push(cursor.value);\r\n            cursor.continue();\r\n        }\r\n        if (version) {\r\n            store.iterateCursor(IDBKeyRange.upperBound(version), cursorCallback);\r\n        } else {\r\n            store.iterateCursor(cursorCallback);\r\n        }\r\n        return tx.complete.then(() => events);\r\n    });\r\n}\r\n\r\nexport function domainEventsByAggregate(aggregateId: AggregateIdType, version?: number): Promise<DomainEvent[]> {\r\n    return open().then(db => {\r\n        let events = [] as DomainEvent[];\r\n        let tx = db.transaction(domainEventStoreName);\r\n        let index = tx.objectStore(domainEventStoreName).index(aggregateIdPropName);\r\n        function cursorCallback(cursor: Cursor) {\r\n            if (!cursor) return;\r\n            let event = cursor.value as DomainEvent;\r\n            if (!version || event.id <= version) {\r\n                events.push(event);\r\n            }\r\n            cursor.continue();\r\n        }\r\n        index.iterateCursor(cursorCallback);\r\n        return tx.complete.then(() => events);\r\n    });\r\n}\r\nexport function postDomainEvents(events: UncommittedDomainEvent[]): Promise<void> {\r\n    return open().then(db => {\r\n        let tx = db.transaction(domainEventStoreName, \"readwrite\");\r\n        let store = tx.objectStore(domainEventStoreName);\r\n        events.forEach(x => store.add(x));\r\n        return tx.complete;\r\n    });\r\n}\n\n\n// WEBPACK FOOTER //\n// ./event-store.ts","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/uuid/index.js\n// module id = 3\n// module chunks = 0","import { AggregateRoot } from \"./aggregate-root\";\r\nimport { Todo, CompletedTodo, TodoIdType } from \"./todo\";\r\nimport { TodoAdded, TodoRemoved, TodoCompleted, TodoUncompleted, TodoRenamed, TodoPositionChanged } from \"./events\";\r\nimport { v4 as uuid } from \"uuid\";\r\n\r\nexport class TodoList extends AggregateRoot {\r\n    protected _todos: (Todo | CompletedTodo)[];\r\n    get todos(): Todo[] {\r\n        return this._todos.filter(x => !x.isCompleted);\r\n    }\r\n    get completedTodos(): CompletedTodo[] {\r\n        return (this._todos.filter(x => x.isCompleted) as CompletedTodo[])\r\n            .sort((x, y) => {\r\n                return y.completionTimestamp - x.completionTimestamp\r\n            });\r\n    }\r\n    protected init(): void {\r\n        super.init();\r\n        this._todos = [];\r\n    }\r\n\r\n    // Domain Event Handlers\r\n    protected TodoAdded(e: TodoAdded): void {\r\n        if (!this.id) {\r\n            this._id = e.aggregateId;\r\n        }\r\n        this._todos.push(new Todo(e.todoId, e.todoName))\r\n    }\r\n    protected TodoRemoved(e: TodoRemoved): void {\r\n        let i = this._todos.findIndex(x => x.id === e.todoId);\r\n        if (i !== -1) {\r\n            this._todos.splice(i, 1)\r\n        }\r\n    }\r\n    protected TodoCompleted(e: TodoCompleted): void {\r\n        let i = this._todos.findIndex(x => x.id === e.todoId);\r\n        if (i !== -1) {\r\n            let oldTodo = this._todos[i];\r\n            let newTodo = new CompletedTodo(oldTodo.id, oldTodo.name, e.todoCompletionTimestamp);\r\n            this._todos[i] = newTodo;\r\n        }\r\n    }\r\n    protected TodoUncompleted(e: TodoUncompleted): void {\r\n        let i = this._todos.findIndex(x => x.id === e.todoId);\r\n        if (i !== -1) {\r\n            let oldTodo = this._todos[i];\r\n            let newTodo = new Todo(oldTodo.id, oldTodo.name);\r\n            this._todos[i] = newTodo;\r\n        }\r\n    }\r\n    protected TodoRenamed(e: TodoRenamed): void {\r\n        let todo = this._todos.find(x => x.id === e.todoId);\r\n        if (todo) {\r\n            todo.name = e.todoName;\r\n        }\r\n    }\r\n    protected TodoPositionChanged(e: TodoPositionChanged): void {\r\n        let incompleteTodoPositions: number[] = this._todos.reduce<number[]>((p, c, i) => {\r\n            if (!c.isCompleted) {\r\n                p.push(i);\r\n            }\r\n            return p;\r\n        }, new Array<number>());\r\n        let from = incompleteTodoPositions.findIndex(x => this._todos[x].id === e.todoId);\r\n        if (from === -1) {\r\n            return;\r\n        }\r\n        let to = from + e.todoOffset;\r\n        if (to < 0) {\r\n            to = 0;\r\n        } else if (to > incompleteTodoPositions.length - 1) {\r\n            to = incompleteTodoPositions.length - 1;\r\n        }\r\n        if (from === to) {\r\n            return;\r\n        }\r\n        if (to < from) {\r\n            for (let i = to; i < from; i++) {\r\n                arraySwap(this._todos, incompleteTodoPositions[from], incompleteTodoPositions[i]);\r\n            }\r\n        } else {\r\n            for (let i = to; i > from; i--) {\r\n                arraySwap(this._todos, incompleteTodoPositions[from], incompleteTodoPositions[i]);\r\n            }\r\n        }\r\n        function arraySwap(arr: Array<any>, x: number, y: number) {\r\n            let a = arr[x];\r\n            arr[x] = arr[y];\r\n            arr[y] = a;\r\n        }\r\n    }\r\n\r\n    add(id: TodoIdType, name: string) {\r\n        let agId = this.id || uuid();\r\n        this.applyAndStage(new TodoAdded(agId, id, name));\r\n    }\r\n    remove(id: TodoIdType) {\r\n        this.applyAndStage(new TodoRemoved(this.id, id));\r\n    }\r\n    complete(id: TodoIdType, completionTimestamp: number) {\r\n        this.applyAndStage(new TodoCompleted(this.id, id, completionTimestamp));\r\n    }\r\n    uncomplete(id: TodoIdType) {\r\n        this.applyAndStage(new TodoUncompleted(this.id, id));\r\n    }\r\n    rename(id: TodoIdType, name: string) {\r\n        this.applyAndStage(new TodoRenamed(this.id, id, name));\r\n    }\r\n    changePosition(id: TodoIdType, offset: number) {\r\n        this.applyAndStage(new TodoPositionChanged(this.id, id, offset));\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./domain/todo-list.ts","import { Todo, CompletedTodo } from \"../domain/todo\";\r\nimport { templateClone, fillControllerElements } from \"../utils\";\r\nimport { Dependencies } from \"../dependencies\";\r\n\r\nexport function historyTodoController(di: Dependencies, todo: Todo | CompletedTodo): DocumentFragment {\r\n    let fragment = (todo.isCompleted)\r\n        ? templateClone(\"historyCompletedTodoTemplate\")\r\n        : templateClone(\"historyTodoTemplate\");\r\n    fillControllerElements(fragment, \"historyTodoTitlePanelController\", di.historyTodoTitlePanelController(di, todo));\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./controllers/history-todo-controller.ts","import { AggregateIdType, DomainEvent, DomainEventType, allDomainEvents, domainEventsByAggregate } from \"./event-store\";\r\n\r\nexport function todoListEvents(): Promise<DomainEvent[]> {\r\n    // This app's domain and event-store are designed to accommodate multiple aggregates of different types.\r\n    // Currently, the app only has one aggregate type (TodoList) and only allows the user to have one instance of that aggregate.\r\n    // This todoLists() lookup occurs to get the aggreateId of the user's one TodoList.\r\n    return allDomainEvents()\r\n        .then(events => {\r\n            let lists = todoLists(events);\r\n            return (lists.length)\r\n                ? domainEventsByAggregate(lists[0])\r\n                : [];\r\n        })\r\n}\r\n\r\nfunction todoLists(events: DomainEvent[]): AggregateIdType[] {\r\n    return events.reduce<AggregateIdType[]>((p, c) => {\r\n        if (c.type === DomainEventType.TodoAdded && p.indexOf(c.aggregateId) === -1) {\r\n            p.push(c.aggregateId);\r\n        }\r\n        return p;\r\n    }, []);\r\n}\n\n\n// WEBPACK FOOTER //\n// ./read.ts","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return  bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/uuid/lib/bytesToUuid.js\n// module id = 7\n// module chunks = 0","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\nvar rng;\n\nvar crypto = global.crypto || global.msCrypto; // for IE 11\nif (crypto && crypto.getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16);\n  rng = function whatwgRNG() {\n    crypto.getRandomValues(rnds8);\n    return rnds8;\n  };\n}\n\nif (!rng) {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var  rnds = new Array(16);\n  rng = function() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n\nmodule.exports = rng;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/uuid/lib/rng-browser.js\n// module id = 8\n// module chunks = 0","import { Dependencies } from \"../dependencies\";\r\nimport { templateClone, findElement } from \"../utils\";\r\nimport { invalidNameInputHandler } from \"../app.common\";\r\nimport { domainEventsByAggregate, postDomainEvents, AggregateIdType } from \"../event-store\";\r\nimport { todoListEvents } from \"../read\";\r\nimport { v4 as uuid } from \"uuid\";\r\nimport { TodoList } from \"../domain/todo-list\";\r\n\r\nexport function addTodoFormController(di: Dependencies, todoListId: AggregateIdType): DocumentFragment {\r\n    let fragment = templateClone(\"addTodoFormTemplate\");\r\n    let addTodoForm = findElement(fragment, \"#addTodoForm\") as HTMLFormElement;\r\n    let addTodoInput = findElement(addTodoForm, \"#addTodoInput\") as HTMLInputElement;\r\n    $(addTodoInput).on(\"invalid\", invalidNameInputHandler);\r\n    $(addTodoForm).submit(function (e) {\r\n        e.preventDefault();\r\n        // This is to deal with the possibility that the user opens the app for the first time in two tabs\r\n        // and adds a to-do to each new TodoList. TodoList ids are generated when the first Todo is\r\n        // added to them. So, on first load, there are no Todos and no TodoLists, and this handler\r\n        // can't know whether to create a new TodoList or load one that might have been made in another tab.\r\n        // So, if the current TodoList has no id -- i.e. no todos have been added -- we check if any other\r\n        // tab has added a new TodoList and use that id.\r\n        let eventsPromise = (todoListId)\r\n            ? domainEventsByAggregate(todoListId)\r\n            : todoListEvents();\r\n        eventsPromise.then((events) => {\r\n            let todoList = new TodoList(events);\r\n            todoList.add(uuid(), addTodoInput.value);\r\n            addTodoForm.reset();\r\n            // This assignment is only necessary when the first Todo is added to a new TodoList.\r\n            todoListId = todoList.id;\r\n            return postDomainEvents(todoList.uncommittedEvents);\r\n        }).then(() => di.refreshLists(di, todoListId))\r\n        .catch(console.log);\r\n    });\r\n    return fragment;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./controllers/add-todo-form-controller.ts","import { Dependencies } from \"../dependencies\";\r\nimport { DomainEvent } from \"../event-store\";\r\nimport { templateClone, fillControllerElements } from \"../utils\";\r\n\r\nexport function bodyController(di: Dependencies, events: DomainEvent[]): DocumentFragment {\r\n    let fragment = templateClone(\"bodyTemplate\");\r\n    fillControllerElements(fragment, \"todoListPanelController\", di.todoListPanelController(di, events));\r\n    fillControllerElements(fragment, \"eventListController\", di.eventListController(di, events));\r\n    return fragment;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./controllers/body-controller.ts","import { CompletedTodo } from \"../domain/todo\";\r\nimport { templateClone, fillControllerElements } from \"../utils\";\r\nimport { Dependencies } from \"../dependencies\";\r\n\r\nexport function completedTodoListController(di: Dependencies, todos: CompletedTodo[]): DocumentFragment {\r\n    if (!todos.length) {\r\n        return document.createDocumentFragment();\r\n    }\r\n    let fragment = templateClone(\"completedTodoListTemplate\");\r\n    fillControllerElements(fragment, \"todoListController\", di.todoListController(di, todos));\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./controllers/completed-todo-list-controller.ts","import { templateClone, fillControllerElements, findElement, getRequiredAttribute } from \"../utils\";\r\nimport { DomainEvent } from \"../event-store\";\r\nimport { Dependencies } from \"../dependencies\";\r\nimport { eventIdDataAttrName } from \"../app.common\";\r\nimport { historyTodoController } from \"./history-todo-controller\";\r\nimport { v4 as uuid } from \"uuid\";\r\n\r\nexport function eventListController(di: Dependencies, events: DomainEvent[]): DocumentFragment {\r\n    if (!events.length) {\r\n        return templateClone(\"emptyEventListTemplate\");\r\n    }\r\n    let todoListId = events[0].aggregateId;\r\n    let fragment = templateClone(\"eventListTemplate\");\r\n    let historyDi = Object.assign({}, di);\r\n    historyDi.todoController = historyTodoController;\r\n    let eventListDelegatedEventTarget = findElement(fragment, \"#eventListDelegatedEventTarget\");\r\n    let $eventListDelegatedEventTarget = $(eventListDelegatedEventTarget);\r\n    $eventListDelegatedEventTarget.on(\"click\", \".event-list-item\", function (e) {\r\n        let refreshBodyEventNamespace = \".activeEventFocusOut:\" + uuid();\r\n        // This handler will reset the body to the interactive todolist when the user clicks\r\n        // anywhere in the document outside of the event list.\r\n        $(document).on(`click${refreshBodyEventNamespace} keypress${refreshBodyEventNamespace}`, function (e2) {\r\n            // Short-circuit when handler is triggered by event that created it\r\n            // or when isn't an 'enter' keypress\r\n            // or when the event-list-item contains the click target\r\n            if (e.originalEvent === e2.originalEvent\r\n                || (e2.type === \"keypress\" && e2.which !== 13)\r\n                || e.currentTarget.contains(e2.target)) {\r\n                return;\r\n            }\r\n            $(document).off(refreshBodyEventNamespace);\r\n            if (!eventListDelegatedEventTarget.contains(e2.target)) {\r\n                di.refreshBody(di, todoListId)\r\n                .catch(console.log);\r\n            }\r\n        });\r\n        let eventId = getRequiredAttribute(e.currentTarget, eventIdDataAttrName);\r\n        let historyEvents = events.slice(0, parseInt(eventId));\r\n        fillControllerElements(document, \"todoListPanelController\", historyDi.historyTodoListPanelController(historyDi, historyEvents));\r\n    });\r\n    fillControllerElements(fragment, \"eventListGroupController\", di.eventListGroupController(di, events));\r\n    return fragment;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./controllers/event-list-controller.ts","import { DomainEvent } from \"../event-store\";\r\nimport { templateClone, fillControllerElements, setAttrElements } from \"../utils\";\r\nimport { Dependencies } from \"../dependencies\";\r\nimport { eventIdDataAttrName } from \"../app.common\";\r\n\r\nexport function eventListGroupController(di: Dependencies, events: DomainEvent[]): DocumentFragment {\r\n    if (events.length) {\r\n        let fragment = document.createDocumentFragment();\r\n        events.forEach(e => {\r\n            let listItemFragment = templateClone(\"eventListItemTemplate\");\r\n            setAttrElements(listItemFragment, eventIdDataAttrName, e.id.toString());\r\n            fillControllerElements(listItemFragment, \"eventTextController\", di.eventTextController(di, e));\r\n            fragment.appendChild(listItemFragment);\r\n        });\r\n        return fragment;\r\n    } else {\r\n        let fragment = templateClone(\"emptyEventListTemplate\");\r\n        return fragment;\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./controllers/event-list-group-controller.ts","import { DomainEvent, DomainEventType } from \"../event-store\";\r\nimport { Dependencies } from \"../dependencies\";\r\n\r\nexport function eventTextController(di: Dependencies, event: DomainEvent): DocumentFragment {\r\n    let fragment = document.createDocumentFragment();\r\n    fragment.textContent = `${event.id} : ${DomainEventType[event.type]}`;\r\n    return fragment;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./controllers/event-text-controller.ts","import { Dependencies } from \"../dependencies\";\r\nimport { DomainEvent } from \"../event-store\";\r\nimport { templateClone, fillControllerElements } from \"../utils\";\r\nimport { TodoList } from \"../domain/todo-list\";\r\n\r\nexport function historyTodoListPanelController(di: Dependencies, events: DomainEvent[]): DocumentFragment {\r\n    let fragment = templateClone(\"historyTodoListPanelTemplate\");\r\n    let todoList = new TodoList(events);\r\n    fillControllerElements(fragment, \"incompleteTodoListController\", di.incompleteTodoListController(di, todoList.todos));\r\n    fillControllerElements(fragment, \"completedTodoListController\", di.completedTodoListController(di, todoList.completedTodos));\r\n    return fragment;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./controllers/history-todo-list-panel-controller.ts","import { Todo, CompletedTodo } from \"../domain/todo\";\r\nimport { templateClone, fillControllerElements } from \"../utils\";\r\nimport { Dependencies } from \"../dependencies\";\r\n\r\nexport function historyTodoTitlePanelController(di: Dependencies, todo: Todo | CompletedTodo): DocumentFragment {\r\n    let fragment = templateClone(\"historyTodoTitlePanelTemplate\");\r\n    fillControllerElements(fragment, \"todoTitleController\", di.todoTitleController(di, todo));\r\n    return fragment;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./controllers/history-todo-title-panel-controller.ts","import { Todo } from \"../domain/todo\";\r\nimport { templateClone, fillControllerElements } from \"../utils\";\r\nimport { Dependencies } from \"../dependencies\";\r\n\r\nexport function incompleteTodoListController(di: Dependencies, todos: Todo[]): DocumentFragment {\r\n    if (!todos.length) {\r\n        return document.createDocumentFragment();\r\n    }\r\n    let fragment = templateClone(\"incompleteTodoListTemplate\");\r\n    fillControllerElements(fragment, \"todoListController\", di.todoListController(di, todos)); \r\n    return fragment;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./controllers/incomplete-todo-list-controller.ts","import { Todo, CompletedTodo } from \"../domain/todo\";\r\nimport { templateClone, setAttrElements } from \"../utils\";\r\nimport { todoIdDataAttrName } from \"../app.common\";\r\nimport { Dependencies } from \"../dependencies\";\r\n\r\nexport function todoActionsPanelButtonsController(di: Dependencies, todo: Todo | CompletedTodo): DocumentFragment {\r\n    let fragment = templateClone(\"todoDeleteBtnTemplate\");\r\n    if (!todo.isCompleted) {\r\n        fragment.appendChild(templateClone(\"todoMoveUpBtnTemplate\"));\r\n        fragment.appendChild(templateClone(\"todoMoveDownBtnTemplate\"));\r\n    }\r\n    fragment.appendChild(templateClone(\"todoRenameBtnTemplate\"));\r\n    setAttrElements(fragment, todoIdDataAttrName, todo.id);\r\n    return fragment;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./controllers/todo-actions-panel-buttons-controller.ts","import { Todo, CompletedTodo } from \"../domain/todo\";\r\nimport { templateClone, fillControllerElements } from \"../utils\";\r\nimport { todoTitleController } from \"./todo-title-controller\";\r\nimport { Dependencies } from \"../dependencies\";\r\n\r\nexport function todoActionsPanelController(di: Dependencies, todo: Todo | CompletedTodo): DocumentFragment {\r\n    let fragment = templateClone(\"todoActionsPanelTemplate\");\r\n    fillControllerElements(fragment, \"todoTitleController\", di.todoTitleController(di, todo));\r\n    fillControllerElements(fragment, \"todoActionsPanelButtonsController\", di.todoActionsPanelButtonsController(di, todo));\r\n    return fragment;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./controllers/todo-actions-panel-controller.ts","import { Todo, CompletedTodo } from \"../domain/todo\";\r\nimport { templateClone, fillControllerElements, setAttrElements } from \"../utils\";\r\nimport { todoIdDataAttrName } from \"../app.common\";\r\nimport { Dependencies } from \"../dependencies\";\r\n\r\nexport function todoController(di: Dependencies, todo: Todo | CompletedTodo): DocumentFragment {\r\n    let fragment = (todo.isCompleted)\r\n        ? templateClone(\"completedTodoTemplate\")\r\n        : templateClone(\"todoTemplate\");\r\n    setAttrElements(fragment, todoIdDataAttrName, todo.id);\r\n    fillControllerElements(fragment, \"todoTitlePanelController\", di.todoTitlePanelController(di, todo));\r\n    fillControllerElements(fragment, \"todoActionsPanelController\", di.todoActionsPanelController(di, todo));\r\n    fillControllerElements(fragment, \"todoRenamePanelController\", di.todoRenamePanelController(di, todo));\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./controllers/todo-controller.ts","import { Todo, CompletedTodo } from \"../domain/todo\";\r\nimport { templateClone, fillControllerElements } from \"../utils\";\r\nimport { Dependencies } from \"../dependencies\";\r\n\r\nexport function todoListController(di: Dependencies, todos: (Todo | CompletedTodo)[]): DocumentFragment {\r\n    let fragment = templateClone(\"todoListTemplate\");\r\n    fillControllerElements(fragment, \"todoListGroupController\", di.todoListGroupController(di, todos));\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./controllers/todo-list-controller.ts","import { Todo, CompletedTodo } from \"../domain/todo\";\r\nimport { Dependencies } from \"../dependencies\";\r\n\r\nexport function todoListGroupController(di: Dependencies, todos: (Todo | CompletedTodo)[]): DocumentFragment {\r\n    let fragment = document.createDocumentFragment();\r\n    for (const todo of todos) {\r\n        fragment.appendChild(di.todoController(di, todo))\r\n    }\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./controllers/todo-list-group-controller.ts","import { Dependencies } from \"../dependencies\";\r\nimport { DomainEvent, domainEventsByAggregate, postDomainEvents, AggregateIdType } from \"../event-store\";\r\nimport { templateClone, findElement, getRequiredAttribute, fillControllerElements } from \"../utils\";\r\nimport { TodoList } from \"../domain/todo-list\";\r\nimport { todoIdDataAttrName } from \"../app.common\";\r\nimport { v4 as uuid } from \"uuid\";\r\n\r\nexport function todoListPanelController(di: Dependencies, events: DomainEvent[]): DocumentFragment {\r\n    let fragment = templateClone(\"todoListPanelTemplate\");\r\n    let todoList = new TodoList(events);\r\n    let todoListId = todoList.id;\r\n    let $todoListDelegatedEventTarget = $(findElement(fragment, \"#todolistDelegatedEventTarget\"));\r\n    $todoListDelegatedEventTarget.on(\"submit\", \".renameTodoForm\", function (e) {\r\n        e.preventDefault();\r\n        domainEventsByAggregate(todoListId)\r\n            .then(events => {\r\n                let todoList = new TodoList(events);\r\n                let todoName = $(e.currentTarget).find(\"input[name='name']\").val();\r\n                let todoId = getRequiredAttribute(e.currentTarget, todoIdDataAttrName);\r\n                todoList.rename(todoId, todoName);\r\n                return postDomainEvents(todoList.uncommittedEvents);\r\n            }).then(() => di.refreshLists(di, todoListId))\r\n            .catch(console.log);\r\n    });\r\n    // Need to handle keypress here because the completeTodoBtn is an <a> without an href,\r\n    // so tabbing to it and pressing enter doesn't trigger a click event like it would with a <button>.\r\n    // I want completeTodoBtn to act like a <button>, but it has another <button> inside of it (todoActionsBtn),\r\n    // so browsers and Bootstrap styling wouldn't work if it was a <button> (HTML spec says no interactive content\r\n    // inside interactive content). By using an <a> with no href I get the a.list-group-item Bootstrap styling.\r\n    $todoListDelegatedEventTarget.on(\"click keypress\", \".completeTodoBtn\", function (e) {\r\n        completeTodoBtnHandler(e, true);\r\n    });\r\n    $todoListDelegatedEventTarget.on(\"click keypress\", \".uncompleteTodoBtn\", function (e) {\r\n        completeTodoBtnHandler(e, false);\r\n    });\r\n    function completeTodoBtnHandler(e: JQueryEventObject, isComplete: boolean): void {\r\n        // only handle \"enter\" keypresses\r\n        if (e.type === \"keypress\" && e.which !== 13) {\r\n            return;\r\n        }\r\n        // short-circuit if this event has bubbled up from the todoActionsBtn (which is inside (un)complete todo buttons)\r\n        var todoActionsBtn = $(e.currentTarget).find(\".todoActionsBtn\")[0];\r\n        if (todoActionsBtn === e.target || $.contains(todoActionsBtn, e.target)) {\r\n            return;\r\n        }\r\n        domainEventsByAggregate(todoListId)\r\n            .then(events => {\r\n                let todoList = new TodoList(events);\r\n                let todoId = getRequiredAttribute(e.currentTarget, todoIdDataAttrName);\r\n                if (isComplete) {\r\n                    todoList.complete(todoId, Date.now());\r\n                } else {\r\n                    todoList.uncomplete(todoId);\r\n                }\r\n                return postDomainEvents(todoList.uncommittedEvents);\r\n            }).then(() => di.refreshLists(di, todoListId))\r\n            .catch(console.log);\r\n    }\r\n    $todoListDelegatedEventTarget.on(\"click\", \".moveTodoUpBtn\", function (e) {\r\n        domainEventsByAggregate(todoListId)\r\n            .then(events => {\r\n                let todoList = new TodoList(events);\r\n                let todoId = getRequiredAttribute(e.currentTarget, todoIdDataAttrName);\r\n                todoList.changePosition(todoId, -1);\r\n                return postDomainEvents(todoList.uncommittedEvents);\r\n            }).then(() => di.refreshLists(di, todoListId))\r\n            .catch(console.log);\r\n    });\r\n    $todoListDelegatedEventTarget.on(\"click\", \".moveTodoDownBtn\", function (e) {\r\n        domainEventsByAggregate(todoListId)\r\n            .then(events => {\r\n                let todoList = new TodoList(events);\r\n                let todoId = getRequiredAttribute(e.currentTarget, todoIdDataAttrName);\r\n                todoList.changePosition(todoId, 1);\r\n                return postDomainEvents(todoList.uncommittedEvents);\r\n            }).then(() => di.refreshLists(di, todoListId))\r\n            .catch(console.log);\r\n    });\r\n    $todoListDelegatedEventTarget.on(\"click\", \".deleteTodoBtn\", function (e) {\r\n        domainEventsByAggregate(todoListId)\r\n            .then(events => {\r\n                let todoList = new TodoList(events);\r\n                let todoId = getRequiredAttribute(e.currentTarget, todoIdDataAttrName);\r\n                todoList.remove(todoId);\r\n                return postDomainEvents(todoList.uncommittedEvents);\r\n            }).then(() => di.refreshLists(di, todoListId))\r\n            .catch(console.log);\r\n    });\r\n    $todoListDelegatedEventTarget.on(\"click\", \".todoActionsBtn\", function (e) {\r\n        var $defaultPanel = $(e.currentTarget).closest(\".todoPanelDefault\"),\r\n            $actionsPanel = $defaultPanel.next(),\r\n            $bothPanels = $defaultPanel.add($actionsPanel),\r\n            actionsBtnGroup = $actionsPanel.find(\".todoActionsPanelBtnGroup\")[0],\r\n            eventNamespace = \"click.todoActionsPanelClose:\" + uuid();\r\n        $bothPanels.toggle();\r\n\r\n        // This handler will close (i.e. toggle) the ActionsPanel when the user clicks anywhere in the document outside of the actionsBtnGroup.\r\n        // eventNamespace is unique (probably) so each instance of this handler can only detach itself.\r\n        $(document).on(eventNamespace, function (closeEvent) {\r\n            // Short-circuit when handler is triggered by event that created it.\r\n            // This happens because this handler is created in the todolistDelegatedEventTarget handler but attached to the document.\r\n            // So, when the todolistDelegatedEventTarget handler returns, the click event that triggered it will still bubble to the document.\r\n            if (e.originalEvent === closeEvent.originalEvent) {\r\n                return;\r\n            }\r\n            if (!$.contains(actionsBtnGroup, closeEvent.target)) {\r\n                $bothPanels.toggle();\r\n            }\r\n            $(document).off(eventNamespace);\r\n        });\r\n    });\r\n    $todoListDelegatedEventTarget.on(\"click\", \".renameTodoBtn\", function (e) {\r\n        var $actionsPanel = $(e.currentTarget).closest(\".todoActionsPanel\");\r\n        var $renamePanel = $actionsPanel.next();\r\n        $actionsPanel.add($renamePanel).toggle();\r\n        $renamePanel.find(\".renameTodoBtnClickFocusTarget\").first().focus();\r\n    });\r\n    $todoListDelegatedEventTarget.on(\"blur\", \".renameTodoForm\", function (e) {\r\n        if (!(e.relatedTarget && $.contains(e.currentTarget, e.relatedTarget))) {\r\n            var $renamePanel = $(e.currentTarget).closest(\".todoRenamePanel\");\r\n            $renamePanel.prev().prev().add($renamePanel).toggle();\r\n        }\r\n    });\r\n\r\n    fillControllerElements(fragment, \"addTodoFormController\", di.addTodoFormController(di, todoListId));\r\n    fillControllerElements(fragment, \"incompleteTodoListController\", di.incompleteTodoListController(di, todoList.todos));\r\n    fillControllerElements(fragment, \"completedTodoListController\", di.completedTodoListController(di, todoList.completedTodos));\r\n    return fragment;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./controllers/todo-list-panel-controller.ts","import { Todo, CompletedTodo } from \"../domain/todo\";\r\nimport { templateClone, findElement, setAttrElements } from \"../utils\";\r\nimport { invalidNameInputHandler, todoIdDataAttrName } from \"../app.common\";\r\nimport { Dependencies } from \"../dependencies\";\r\n\r\nexport function todoRenamePanelController(di: Dependencies, todo: Todo | CompletedTodo): DocumentFragment {\r\n    let fragment = templateClone(\"todoRenamePanelTemplate\");\r\n    let input = findElement(fragment, \"input[name='name']\");\r\n    let inputId = input.getAttribute(\"id\");\r\n    let newInputId = `${inputId}-${todo.id}`;\r\n    let label = findElement(fragment, `label[for='${inputId}']`);\r\n    input.setAttribute(\"id\", newInputId);\r\n    input.setAttribute(\"value\", todo.name);\r\n    label.setAttribute(\"for\", newInputId);\r\n    setAttrElements(fragment, todoIdDataAttrName, todo.id);\r\n    $(input).on(\"invalid\", invalidNameInputHandler);\r\n    return fragment;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./controllers/todo-rename-panel-controller.ts","import { Todo, CompletedTodo } from \"../domain/todo\";\r\nimport { templateClone, fillContentElements } from \"../utils\";\r\nimport { Dependencies } from \"../dependencies\";\r\n\r\nexport function todoTitleController(di: Dependencies, todo: Todo | CompletedTodo): DocumentFragment {\r\n    let titleFragment = document.createDocumentFragment();\r\n    titleFragment.textContent = todo.name;\r\n    if (todo.isCompleted) {\r\n        let completionDateFragment = templateClone(\"todoCompletionDateTemplate\");\r\n        let date = new Date((todo as CompletedTodo).completionTimestamp);\r\n        fillContentElements(completionDateFragment, \"completionDate\", date.toLocaleDateString());\r\n        titleFragment.appendChild(completionDateFragment);\r\n    }\r\n    return titleFragment;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./controllers/todo-title-controller.ts","import { Todo, CompletedTodo } from \"../domain/todo\";\r\nimport { templateClone, fillControllerElements } from \"../utils\";\r\nimport { Dependencies } from \"../dependencies\";\r\n\r\nexport function todoTitlePanelController(di: Dependencies, todo: Todo | CompletedTodo): DocumentFragment {\r\n    let fragment = templateClone(\"todoTitlePanelTemplate\");\r\n    fillControllerElements(fragment, \"todoTitleController\", di.todoTitleController(di, todo));\r\n    return fragment;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./controllers/todo-title-panel-controller.ts","import \"./site.css\";\r\nimport { fillControllerElements } from \"./utils\";\r\nimport { todoListEvents } from \"./read\";\r\nimport { Dependencies } from \"./dependencies\";\r\nimport { bodyController } from \"./controllers/body-controller\";\r\nimport { incompleteTodoListController } from \"./controllers/incomplete-todo-list-controller\";\r\nimport { completedTodoListController } from \"./controllers/completed-todo-list-controller\";\r\nimport { todoListController } from \"./controllers/todo-list-controller\";\r\nimport { todoListGroupController } from \"./controllers/todo-list-group-controller\";\r\nimport { todoController } from \"./controllers/todo-controller\";\r\nimport { todoTitlePanelController } from \"./controllers/todo-title-panel-controller\";\r\nimport { todoTitleController } from \"./controllers/todo-title-controller\";\r\nimport { todoActionsPanelController } from \"./controllers/todo-actions-panel-controller\";\r\nimport { todoActionsPanelButtonsController } from \"./controllers/todo-actions-panel-buttons-controller\";\r\nimport { todoRenamePanelController } from \"./controllers/todo-rename-panel-controller\";\r\nimport { eventListController } from \"./controllers/event-list-controller\";\r\nimport { eventListGroupController } from \"./controllers/event-list-group-controller\";\r\nimport { eventTextController } from \"./controllers/event-text-controller\";\r\nimport { addTodoFormController } from \"./controllers/add-todo-form-controller\";\r\nimport { todoListPanelController } from \"./controllers/todo-list-panel-controller\";\r\nimport { historyTodoListPanelController } from \"./controllers/history-todo-list-panel-controller\";\r\nimport { historyTodoController } from \"./controllers/history-todo-controller\";\r\nimport { historyTodoTitlePanelController } from \"./controllers/history-todo-title-panel-controller\";\r\nimport { refreshLists, refreshBody } from \"./app.common\";\r\n\r\nif (!window.indexedDB) {\r\n    window.alert(\"Your browser doesn't support IndexedDB (the browser feature this app uses to store your To-dos). Update your browser to its latest version.\");\r\n}\r\n\r\nconst di: Dependencies = {\r\n    bodyController: bodyController,\r\n    todoListPanelController: todoListPanelController,\r\n    addTodoFormController: addTodoFormController,\r\n    incompleteTodoListController: incompleteTodoListController,\r\n    completedTodoListController: completedTodoListController,\r\n    todoListController: todoListController,\r\n    todoListGroupController: todoListGroupController,\r\n    todoController: todoController,\r\n    todoTitlePanelController: todoTitlePanelController,\r\n    todoTitleController: todoTitleController,\r\n    todoActionsPanelController: todoActionsPanelController,\r\n    todoActionsPanelButtonsController: todoActionsPanelButtonsController,\r\n    todoRenamePanelController: todoRenamePanelController,\r\n    eventListController: eventListController,\r\n    eventListGroupController: eventListGroupController,\r\n    eventTextController: eventTextController,\r\n    refreshLists: refreshLists,\r\n    refreshBody: refreshBody,\r\n    historyTodoListPanelController: historyTodoListPanelController,\r\n    historyTodoController: historyTodoController,\r\n    historyTodoTitlePanelController: historyTodoTitlePanelController\r\n}\r\n\r\ntodoListEvents()\r\n    .then(events => {\r\n        fillControllerElements(document, \"bodyController\", di.bodyController(di, events));\r\n    }).catch(console.log);\n\n\n// WEBPACK FOOTER //\n// ./app.ts","import { DomainEvent, UncommittedDomainEvent, AggregateIdType, DomainEventType } from \"../event-store\";\r\n\r\nexport type DomainEventHandler = (e: UncommittedDomainEvent) => void\r\n\r\nexport abstract class AggregateRoot {\r\n    private _uncommittedEvents: UncommittedDomainEvent[];\r\n    get uncommittedEvents(): UncommittedDomainEvent[] {\r\n        return this._uncommittedEvents;\r\n    }\r\n    protected _id: AggregateIdType\r\n    get id(): AggregateIdType {\r\n        return this._id;\r\n    }\r\n    protected init(): void {\r\n        this._uncommittedEvents = new Array<UncommittedDomainEvent>();\r\n    };\r\n    constructor(events: DomainEvent[]) {\r\n        this.init();\r\n        events.forEach(e => {\r\n            ((this as any)[DomainEventType[e.type]] as DomainEventHandler)(e);\r\n        });\r\n    }\r\n    protected applyAndStage(e: UncommittedDomainEvent) {\r\n        ((this as any)[DomainEventType[e.type]] as DomainEventHandler)(e);\r\n        this._uncommittedEvents.push(e);\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./domain/aggregate-root.ts","import { TodoIdType } from \"./todo\";\r\nimport { UncommittedDomainEvent, AggregateIdType, DomainEventType } from \"../event-store\";\r\n\r\nexport class TodoAdded implements UncommittedDomainEvent {\r\n    readonly type = DomainEventType.TodoAdded;\r\n    constructor(\r\n        readonly aggregateId: AggregateIdType,\r\n        readonly todoId: TodoIdType,\r\n        readonly todoName: string\r\n    ) { }\r\n}\r\n\r\nexport class TodoRemoved implements UncommittedDomainEvent {\r\n    readonly type = DomainEventType.TodoRemoved;\r\n    constructor(\r\n        readonly aggregateId: AggregateIdType,\r\n        readonly todoId: TodoIdType\r\n    ) { }\r\n}\r\n\r\nexport class TodoCompleted implements UncommittedDomainEvent {\r\n    readonly type = DomainEventType.TodoCompleted;\r\n    constructor(\r\n        readonly aggregateId: AggregateIdType,\r\n        readonly todoId: TodoIdType,\r\n        readonly todoCompletionTimestamp: number\r\n    ) { }\r\n}\r\n\r\nexport class TodoUncompleted implements UncommittedDomainEvent {\r\n    readonly type = DomainEventType.TodoUncompleted;\r\n    constructor(\r\n        readonly aggregateId: AggregateIdType,\r\n        readonly todoId: TodoIdType\r\n    ) { }\r\n}\r\n\r\nexport class TodoRenamed implements UncommittedDomainEvent {\r\n    readonly type = DomainEventType.TodoRenamed;\r\n    constructor(\r\n        readonly aggregateId: AggregateIdType,\r\n        readonly todoId: TodoIdType,\r\n        readonly todoName: string\r\n    ) { }\r\n}\r\n\r\nexport class TodoPositionChanged implements UncommittedDomainEvent {\r\n    readonly type = DomainEventType.TodoPositionChanged;\r\n    constructor(\r\n        readonly aggregateId: AggregateIdType,\r\n        readonly todoId: TodoIdType,\r\n        readonly todoOffset: number\r\n    ) { }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./domain/events.ts","export type TodoIdType = string;\r\n\r\nexport class Todo {\r\n    readonly isCompleted: boolean = false;\r\n    constructor(\r\n        readonly id: TodoIdType,\r\n        public name: string\r\n    ) { }\r\n}\r\n\r\nexport class CompletedTodo extends Todo {\r\n    readonly isCompleted: boolean = true;\r\n    constructor(\r\n        id: TodoIdType,\r\n        name: string,\r\n        readonly completionTimestamp: number\r\n    ) {\r\n        super(id, name);\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./domain/todo.ts","'use strict';\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      request.onupgradeneeded = function(event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    module.exports = exp;\n    module.exports.default = module.exports;\n  }\n  else {\n    self.idb = exp;\n  }\n}());\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/idb/lib/idb.js\n// module id = 32\n// module chunks = 0","// Unique ID creation requires a high quality random # generator.  We feature\n// detect to determine the best RNG source, normalizing to a function that\n// returns 128-bits of randomness, since that's what's usually required\nvar rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\n// random #'s we need to init node and clockseq\nvar _seedBytes = rng();\n\n// Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\nvar _nodeId = [\n  _seedBytes[0] | 0x01,\n  _seedBytes[1], _seedBytes[2], _seedBytes[3], _seedBytes[4], _seedBytes[5]\n];\n\n// Per 4.2.2, randomize (14 bit) clockseq\nvar _clockseq = (_seedBytes[6] << 8 | _seedBytes[7]) & 0x3fff;\n\n// Previous uuid creation time\nvar _lastMSecs = 0, _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  var node = options.node || _nodeId;\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/uuid/v1.js\n// module id = 33\n// module chunks = 0","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options == 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/uuid/v4.js\n// module id = 34\n// module chunks = 0","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/global.js\n// module id = 35\n// module chunks = 0"],"sourceRoot":""}